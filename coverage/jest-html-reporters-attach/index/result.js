window.jest_html_reporters_callback__({"numFailedTestSuites":0,"numFailedTests":0,"numPassedTestSuites":2,"numPassedTests":25,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":2,"numTotalTests":25,"startTime":1656657002839,"success":false,"testResults":[{"leaks":false,"numFailingTests":0,"numPassingTests":17,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1656657014217,"runtime":11311,"slow":true,"start":1656657002906},"skipped":false,"testFilePath":"/home/runner/work/express-ts/express-ts/packages/serve/test/app.test.ts","testResults":[{"ancestorTitles":["POST /api/pub/login"],"duration":101,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login check","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"check"},{"ancestorTitles":["POST /api/pub/login"],"duration":271,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login add user su","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"add user su"},{"ancestorTitles":["POST /api/pub/login"],"duration":167,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login add user admin su","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"add user admin su"},{"ancestorTitles":["POST /api/pub/login"],"duration":24,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail pwd short","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail pwd short"},{"ancestorTitles":["POST /api/pub/login"],"duration":21,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail pwd too long","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail pwd too long"},{"ancestorTitles":["POST /api/pub/login"],"duration":27,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login no username","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"no username"},{"ancestorTitles":["POST /api/pub/login"],"duration":20,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail username too long","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail username too long"},{"ancestorTitles":["POST /api/pub/login"],"duration":23,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail no params","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail no params"},{"ancestorTitles":["POST /api/pub/login"],"duration":148,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail pwd1","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail pwd1"},{"ancestorTitles":["POST /api/pub/login"],"duration":145,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail pwd2","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail pwd2"},{"ancestorTitles":["POST /api/pub/login"],"duration":143,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login fail pwd3","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login fail pwd3"},{"ancestorTitles":["POST /api/pub/login"],"duration":146,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login lock","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login lock"},{"ancestorTitles":["POST /api/pub/login"],"duration":157,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login login su","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"login su"},{"ancestorTitles":["POST /api/pub/login"],"duration":25,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login no token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"no token"},{"ancestorTitles":["POST /api/pub/login"],"duration":21,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login token invalid","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"token invalid"},{"ancestorTitles":["POST /api/pub/login"],"duration":43,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login no user","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"no user"},{"ancestorTitles":["POST /api/pub/login"],"duration":39,"failureDetails":[],"failureMessages":[],"fullName":"POST /api/pub/login userInfo","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"userInfo"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createApp = void 0;\nconst express_1 = __importDefault(require(\"express\"));\nconst dotenv_1 = require(\"dotenv\");\nconst body_parser_1 = __importDefault(require(\"body-parser\"));\nconst cors_1 = __importDefault(require(\"cors\"));\nconst user_1 = __importDefault(require(\"./routes/api/user\"));\nconst pub_1 = __importDefault(require(\"./routes/api/pub\"));\nconst express_request_id_1 = __importDefault(require(\"express-request-id\"));\nconst auth_1 = __importDefault(require(\"./middleware/auth\"));\nconst log_1 = __importDefault(require(\"./utils/log\"));\nconst morgan_body_1 = __importDefault(require(\"morgan-body\"));\n// loads the .env file into process.env\nconst envFile = process.env.NODE_ENV ? `.env.${process.env.NODE_ENV}` : '.env';\nconst envDir = process.cwd();\n(0, dotenv_1.config)({ path: `${envDir}/${envFile}` });\nconst createApp = () => {\n    const app = (0, express_1.default)();\n    // set global variable\n    app.set('port', process.env.PORT || 8080);\n    app.set('nodeEnv', process.env.NODE_ENV || 8080);\n    app.get('/', (_req, res) => {\n        res.send('API Running!');\n    });\n    // middleware\n    app.use(body_parser_1.default.json());\n    app.use(body_parser_1.default.urlencoded({ extended: false }));\n    app.use((0, express_request_id_1.default)());\n    app.use((0, cors_1.default)());\n    (0, morgan_body_1.default)(app, {\n        noColors: true,\n        prettify: false,\n        logReqUserAgent: false,\n        logRequestId: true,\n        stream: {\n            write: (message) => {\n                log_1.default.info(message);\n                return true;\n            },\n        },\n    });\n    app.use('/api/pub', pub_1.default);\n    app.use(auth_1.default);\n    app.use('/api/user', user_1.default);\n    return app;\n};\nexports.createApp = createApp;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9hcHAudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsc0RBQTZCO0FBQzdCLG1DQUErQjtBQUMvQiw4REFBb0M7QUFDcEMsZ0RBQXVCO0FBQ3ZCLDZEQUFvQztBQUNwQywyREFBa0M7QUFDbEMsNEVBQTBDO0FBQzFDLDZEQUFvQztBQUNwQyxzREFBNkI7QUFDN0IsOERBQW9DO0FBQ3BDLHVDQUF1QztBQUN2QyxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsUUFBUSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUE7QUFDOUUsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFBO0FBQzVCLElBQUEsZUFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFJLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUVqQyxNQUFNLFNBQVMsR0FBRyxHQUFHLEVBQUU7SUFDNUIsTUFBTSxHQUFHLEdBQUcsSUFBQSxpQkFBTyxHQUFFLENBQUE7SUFFckIsc0JBQXNCO0lBQ3RCLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFBO0lBQ3pDLEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxDQUFBO0lBRWhELEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3pCLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUE7SUFDMUIsQ0FBQyxDQUFDLENBQUE7SUFDRixhQUFhO0lBQ2IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7SUFDMUIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxxQkFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFDbkQsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFBLDRCQUFTLEdBQUUsQ0FBQyxDQUFBO0lBQ3BCLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBQSxjQUFJLEdBQUUsQ0FBQyxDQUFBO0lBQ2YsSUFBQSxxQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLFFBQVEsRUFBRSxJQUFJO1FBQ2QsUUFBUSxFQUFFLEtBQUs7UUFDZixlQUFlLEVBQUUsS0FBSztRQUN0QixZQUFZLEVBQUUsSUFBSTtRQUNsQixNQUFNLEVBQUU7WUFDTixLQUFLLEVBQUUsQ0FBQyxPQUFPLEVBQUUsRUFBRTtnQkFDakIsYUFBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtnQkFDakIsT0FBTyxJQUFJLENBQUE7WUFDYixDQUFDO1NBQ0Y7S0FDRixDQUFDLENBQUE7SUFFRixHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxhQUFHLENBQUMsQ0FBQTtJQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLGNBQUksQ0FBQyxDQUFBO0lBQ2IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsY0FBSSxDQUFDLENBQUE7SUFDMUIsT0FBTyxHQUFHLENBQUE7QUFDWixDQUFDLENBQUE7QUFoQ1ksUUFBQSxTQUFTLGFBZ0NyQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJ1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnZG90ZW52J1xuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInXG5pbXBvcnQgY29ycyBmcm9tICdjb3JzJ1xuaW1wb3J0IHVzZXIgZnJvbSAnLi9yb3V0ZXMvYXBpL3VzZXInXG5pbXBvcnQgcHViIGZyb20gJy4vcm91dGVzL2FwaS9wdWInXG5pbXBvcnQgcmVxdWVzdElEIGZyb20gJ2V4cHJlc3MtcmVxdWVzdC1pZCdcbmltcG9ydCBhdXRoIGZyb20gJy4vbWlkZGxld2FyZS9hdXRoJ1xuaW1wb3J0IExvZyBmcm9tICcuL3V0aWxzL2xvZydcbmltcG9ydCBtb3JnYW5Cb2R5IGZyb20gJ21vcmdhbi1ib2R5J1xuLy8gbG9hZHMgdGhlIC5lbnYgZmlsZSBpbnRvIHByb2Nlc3MuZW52XG5jb25zdCBlbnZGaWxlID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPyBgLmVudi4ke3Byb2Nlc3MuZW52Lk5PREVfRU5WfWAgOiAnLmVudidcbmNvbnN0IGVudkRpciA9IHByb2Nlc3MuY3dkKClcbmNvbmZpZyh7IHBhdGg6IGAke2VudkRpcn0vJHtlbnZGaWxlfWAgfSlcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUFwcCA9ICgpID0+IHtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpXG5cbiAgLy8gc2V0IGdsb2JhbCB2YXJpYWJsZVxuICBhcHAuc2V0KCdwb3J0JywgcHJvY2Vzcy5lbnYuUE9SVCB8fCA4MDgwKVxuICBhcHAuc2V0KCdub2RlRW52JywgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgODA4MClcblxuICBhcHAuZ2V0KCcvJywgKF9yZXEsIHJlcykgPT4ge1xuICAgIHJlcy5zZW5kKCdBUEkgUnVubmluZyEnKVxuICB9KVxuICAvLyBtaWRkbGV3YXJlXG4gIGFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpXG4gIGFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IGZhbHNlIH0pKVxuICBhcHAudXNlKHJlcXVlc3RJRCgpKVxuICBhcHAudXNlKGNvcnMoKSlcbiAgbW9yZ2FuQm9keShhcHAsIHtcbiAgICBub0NvbG9yczogdHJ1ZSxcbiAgICBwcmV0dGlmeTogZmFsc2UsXG4gICAgbG9nUmVxVXNlckFnZW50OiBmYWxzZSxcbiAgICBsb2dSZXF1ZXN0SWQ6IHRydWUsXG4gICAgc3RyZWFtOiB7XG4gICAgICB3cml0ZTogKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgTG9nLmluZm8obWVzc2FnZSlcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcblxuICBhcHAudXNlKCcvYXBpL3B1YicsIHB1YilcbiAgYXBwLnVzZShhdXRoKVxuICBhcHAudXNlKCcvYXBpL3VzZXInLCB1c2VyKVxuICByZXR1cm4gYXBwXG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import express from 'express'\nimport { config } from 'dotenv'\nimport bodyParser from 'body-parser'\nimport cors from 'cors'\nimport user from './routes/api/user'\nimport pub from './routes/api/pub'\nimport requestID from 'express-request-id'\nimport auth from './middleware/auth'\nimport Log from './utils/log'\nimport morganBody from 'morgan-body'\n// loads the .env file into process.env\nconst envFile = process.env.NODE_ENV ? `.env.${process.env.NODE_ENV}` : '.env'\nconst envDir = process.cwd()\nconfig({ path: `${envDir}/${envFile}` })\n\nexport const createApp = () => {\n  const app = express()\n\n  // set global variable\n  app.set('port', process.env.PORT || 8080)\n  app.set('nodeEnv', process.env.NODE_ENV || 8080)\n\n  app.get('/', (_req, res) => {\n    res.send('API Running!')\n  })\n  // middleware\n  app.use(bodyParser.json())\n  app.use(bodyParser.urlencoded({ extended: false }))\n  app.use(requestID())\n  app.use(cors())\n  morganBody(app, {\n    noColors: true,\n    prettify: false,\n    logReqUserAgent: false,\n    logRequestId: true,\n    stream: {\n      write: (message) => {\n        Log.info(message)\n        return true\n      },\n    },\n  })\n\n  app.use('/api/pub', pub)\n  app.use(auth)\n  app.use('/api/user', user)\n  return app\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/52/app_527bca95c7489602b7db65708a5d64b2.map","wrapperLength":82},"result":{"scriptId":"1294","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/app.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6098,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6095,"count":1},{"startOffset":1018,"endOffset":1026,"count":0}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":9},{"startOffset":204,"endOffset":209,"count":4},{"startOffset":210,"endOffset":230,"count":5}],"isBlockCoverage":true},{"functionName":"createApp","ranges":[{"startOffset":1132,"endOffset":2036,"count":1},{"startOffset":1246,"endOffset":1253,"count":0},{"startOffset":1300,"endOffset":1307,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1327,"endOffset":1383,"count":1}],"isBlockCoverage":true},{"functionName":"write","ranges":[{"startOffset":1785,"endOffset":1887,"count":48}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst express_1 = require(\"express\");\nconst index_1 = require(\"./../../utils/index\");\nconst index_2 = require(\"./../../service/user/index\");\nconst router = (0, express_1.Router)();\nrouter.get('/info', (req, res) => __awaiter(void 0, void 0, void 0, function* () {\n    var _a;\n    const user = yield (0, index_2.FindUser)(String((_a = req.tokenInfo) === null || _a === void 0 ? void 0 : _a.uid));\n    if (!user) {\n        (0, index_1.ResJson)(req, res, {}, 1004);\n        return;\n    }\n    (0, index_1.ResJson)(req, res, user);\n    return;\n}));\nexports.default = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9yb3V0ZXMvYXBpL3VzZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSxxQ0FBbUQ7QUFDbkQsK0NBQTZDO0FBQzdDLHNEQUFxRDtBQUVyRCxNQUFNLE1BQU0sR0FBVyxJQUFBLGdCQUFNLEdBQUUsQ0FBQTtBQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFPLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTs7SUFDeEQsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFBLGdCQUFRLEVBQUMsTUFBTSxDQUFDLE1BQUEsR0FBRyxDQUFDLFNBQVMsMENBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUN2RCxJQUFJLENBQUMsSUFBSSxFQUFFO1FBQ1QsSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDM0IsT0FBTTtLQUNQO0lBQ0QsSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUN2QixPQUFNO0FBQ1IsQ0FBQyxDQUFBLENBQUMsQ0FBQTtBQUVGLGtCQUFlLE1BQU0sQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL3JvdXRlcy9hcGkvdXNlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXF1ZXN0LCBSb3V0ZXIsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcydcbmltcG9ydCB7IFJlc0pzb24gfSBmcm9tICcuLy4uLy4uL3V0aWxzL2luZGV4J1xuaW1wb3J0IHsgRmluZFVzZXIgfSBmcm9tICcuLy4uLy4uL3NlcnZpY2UvdXNlci9pbmRleCdcblxuY29uc3Qgcm91dGVyOiBSb3V0ZXIgPSBSb3V0ZXIoKVxucm91dGVyLmdldCgnL2luZm8nLCBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBGaW5kVXNlcihTdHJpbmcocmVxLnRva2VuSW5mbz8udWlkKSlcbiAgaWYgKCF1c2VyKSB7XG4gICAgUmVzSnNvbihyZXEsIHJlcywge30sIDEwMDQpXG4gICAgcmV0dXJuXG4gIH1cbiAgUmVzSnNvbihyZXEsIHJlcywgdXNlcilcbiAgcmV0dXJuXG59KVxuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXJcbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { Request, Router, Response } from 'express'\nimport { ResJson } from './../../utils/index'\nimport { FindUser } from './../../service/user/index'\n\nconst router: Router = Router()\nrouter.get('/info', async (req: Request, res: Response) => {\n  const user = await FindUser(String(req.tokenInfo?.uid))\n  if (!user) {\n    ResJson(req, res, {}, 1004)\n    return\n  }\n  ResJson(req, res, user)\n  return\n})\n\nexport default router\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/b0/user_b01d22e2711d715ebdf1d2f122bc2b3b.map","wrapperLength":82},"result":{"scriptId":"1381","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/routes/api/user.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":3023,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":3020,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":2}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":2},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":2}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":2},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":2},{"startOffset":636,"endOffset":683,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1041,"endOffset":1381,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1089,"endOffset":1380,"count":2},{"startOffset":1215,"endOffset":1223,"count":0},{"startOffset":1251,"endOffset":1379,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SetCacheData = exports.GetCacheData = exports.SafeData = exports.ResJson = void 0;\nconst jwt_1 = require(\"./jwt\");\nconst msg_1 = require(\"./../msg\");\nconst log_1 = __importDefault(require(\"./log\"));\nconst CacheObj = {\n    username: {},\n};\nconst ResJson = (req, res, data, code = 0, msg = '', token = '') => __awaiter(void 0, void 0, void 0, function* () {\n    // auto cerate new token if token is expired\n    if (!token && req.needNewToken) {\n        delete req.tokenInfo.exp;\n        delete req.tokenInfo.iat;\n        token = yield (0, jwt_1.GetJwt)(req.tokenInfo);\n    }\n    // locked user tips\n    if (code === 1000) {\n        const min = Number(process.env.LOCK_EXPIRATION || 1) / 60;\n        msg = msg_1.Msg[code] + `,Please try again in ${min} minutes`;\n    }\n    const re = {\n        code,\n        data,\n        msg,\n        token,\n    };\n    return res.json(re);\n});\nexports.ResJson = ResJson;\nconst SafeData = (argData, argCheck, argValue, argSetValueForce) => {\n    if (typeof argCheck !== 'string' && typeof argCheck !== 'number') {\n        return '';\n    }\n    const temKey = argCheck.toString().split('.');\n    const temLen = temKey.length;\n    if (!argData) {\n        return argValue;\n    }\n    if (temLen > 1) {\n        for (let i = 0; i < temLen - 1; i++) {\n            if (typeof argData[temKey[i]] !== 'object') {\n                if (argSetValueForce) {\n                    log_1.default.error(`${temKey[i]} is not object`);\n                }\n                return argValue;\n            }\n            argData = argData[temKey[i]];\n        }\n    }\n    if (argSetValueForce) {\n        argData[temKey[temLen - 1]] = argValue;\n    }\n    if (typeof argValue === 'undefined') {\n        return argData[temKey[temLen - 1]];\n    }\n    else {\n        return argData[temKey[temLen - 1]] || argValue;\n    }\n};\nexports.SafeData = SafeData;\nconst GetCacheData = (key, value) => {\n    return (0, exports.SafeData)(CacheObj, key, value);\n};\nexports.GetCacheData = GetCacheData;\nconst SetCacheData = (key, value) => {\n    return (0, exports.SafeData)(CacheObj, key, value, true);\n};\nexports.SetCacheData = SetCacheData;\n// export const Sleep = (ms: number) => {\n//   return new Promise((resolve) => setTimeout(resolve, ms))\n// }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFFQSwrQkFBOEI7QUFFOUIsa0NBQThCO0FBQzlCLGdEQUF1QjtBQUt2QixNQUFNLFFBQVEsR0FBYztJQUMxQixRQUFRLEVBQUUsRUFBRTtDQUNiLENBQUE7QUFDTSxNQUFNLE9BQU8sR0FBRyxDQUNyQixHQUFZLEVBQ1osR0FBYSxFQUNiLElBQVMsRUFDVCxJQUFJLEdBQUcsQ0FBQyxFQUNSLEdBQUcsR0FBRyxFQUFFLEVBQ1IsS0FBSyxHQUFHLEVBQUUsRUFDVixFQUFFO0lBQ0YsNENBQTRDO0lBQzVDLElBQUksQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLFlBQVksRUFBRTtRQUM5QixPQUFPLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFBO1FBQ3hCLE9BQU8sR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUE7UUFDeEIsS0FBSyxHQUFHLE1BQU0sSUFBQSxZQUFNLEVBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO0tBQ3BDO0lBQ0QsbUJBQW1CO0lBQ25CLElBQUksSUFBSSxLQUFLLElBQUksRUFBRTtRQUNqQixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ3pELEdBQUcsR0FBRyxTQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsd0JBQXdCLEdBQUcsVUFBVSxDQUFBO0tBQ3hEO0lBQ0QsTUFBTSxFQUFFLEdBQVM7UUFDZixJQUFJO1FBQ0osSUFBSTtRQUNKLEdBQUc7UUFDSCxLQUFLO0tBQ04sQ0FBQTtJQUNELE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNyQixDQUFDLENBQUEsQ0FBQTtBQTFCWSxRQUFBLE9BQU8sV0EwQm5CO0FBRU0sTUFBTSxRQUFRLEdBQUcsQ0FDdEIsT0FBWSxFQUNaLFFBQWdCLEVBQ2hCLFFBQWMsRUFDZCxnQkFBa0MsRUFDN0IsRUFBRTtJQUNQLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsRUFBRTtRQUNoRSxPQUFPLEVBQUUsQ0FBQTtLQUNWO0lBQ0QsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM3QyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFBO0lBQzVCLElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDWixPQUFPLFFBQVEsQ0FBQTtLQUNoQjtJQUNELElBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNkLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ25DLElBQUksT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxFQUFFO2dCQUMxQyxJQUFJLGdCQUFnQixFQUFFO29CQUNwQixhQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO2lCQUN4QztnQkFDRCxPQUFPLFFBQVEsQ0FBQTthQUNoQjtZQUNELE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDN0I7S0FDRjtJQUNELElBQUksZ0JBQWdCLEVBQUU7UUFDcEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUE7S0FDdkM7SUFDRCxJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsRUFBRTtRQUNuQyxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbkM7U0FBTTtRQUNMLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUE7S0FDL0M7QUFDSCxDQUFDLENBQUE7QUFqQ1ksUUFBQSxRQUFRLFlBaUNwQjtBQUVNLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBVyxFQUFFLEtBQVUsRUFBRSxFQUFFO0lBQ3RELE9BQU8sSUFBQSxnQkFBUSxFQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDdkMsQ0FBQyxDQUFBO0FBRlksUUFBQSxZQUFZLGdCQUV4QjtBQUVNLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBVyxFQUFFLEtBQVUsRUFBRSxFQUFFO0lBQ3RELE9BQU8sSUFBQSxnQkFBUSxFQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzdDLENBQUMsQ0FBQTtBQUZZLFFBQUEsWUFBWSxnQkFFeEI7QUFFRCx5Q0FBeUM7QUFDekMsNkRBQTZEO0FBQzdELElBQUkiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUmVzIH0gZnJvbSAndHlwZXMvY29tbW9uJ1xuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJ1xuaW1wb3J0IHsgR2V0Snd0IH0gZnJvbSAnLi9qd3QnXG5pbXBvcnQgeyBJVXNlcm5hbWUgfSBmcm9tICdzZXJ2aWNlL3VzZXIvdHlwZXMnXG5pbXBvcnQgeyBNc2cgfSBmcm9tICcuLy4uL21zZydcbmltcG9ydCBMb2cgZnJvbSAnLi9sb2cnXG5cbmludGVyZmFjZSBJQ2FjaGVPYmoge1xuICB1c2VybmFtZTogeyBba2V5OiBzdHJpbmddOiBJVXNlcm5hbWUgfVxufVxuY29uc3QgQ2FjaGVPYmo6IElDYWNoZU9iaiA9IHtcbiAgdXNlcm5hbWU6IHt9LFxufVxuZXhwb3J0IGNvbnN0IFJlc0pzb24gPSBhc3luYyAoXG4gIHJlcTogUmVxdWVzdCxcbiAgcmVzOiBSZXNwb25zZSxcbiAgZGF0YTogYW55LFxuICBjb2RlID0gMCxcbiAgbXNnID0gJycsXG4gIHRva2VuID0gJydcbikgPT4ge1xuICAvLyBhdXRvIGNlcmF0ZSBuZXcgdG9rZW4gaWYgdG9rZW4gaXMgZXhwaXJlZFxuICBpZiAoIXRva2VuICYmIHJlcS5uZWVkTmV3VG9rZW4pIHtcbiAgICBkZWxldGUgcmVxLnRva2VuSW5mby5leHBcbiAgICBkZWxldGUgcmVxLnRva2VuSW5mby5pYXRcbiAgICB0b2tlbiA9IGF3YWl0IEdldEp3dChyZXEudG9rZW5JbmZvKVxuICB9XG4gIC8vIGxvY2tlZCB1c2VyIHRpcHNcbiAgaWYgKGNvZGUgPT09IDEwMDApIHtcbiAgICBjb25zdCBtaW4gPSBOdW1iZXIocHJvY2Vzcy5lbnYuTE9DS19FWFBJUkFUSU9OIHx8IDEpIC8gNjBcbiAgICBtc2cgPSBNc2dbY29kZV0gKyBgLFBsZWFzZSB0cnkgYWdhaW4gaW4gJHttaW59IG1pbnV0ZXNgXG4gIH1cbiAgY29uc3QgcmU6IElSZXMgPSB7XG4gICAgY29kZSxcbiAgICBkYXRhLFxuICAgIG1zZyxcbiAgICB0b2tlbixcbiAgfVxuICByZXR1cm4gcmVzLmpzb24ocmUpXG59XG5cbmV4cG9ydCBjb25zdCBTYWZlRGF0YSA9IChcbiAgYXJnRGF0YTogYW55LFxuICBhcmdDaGVjazogc3RyaW5nLFxuICBhcmdWYWx1ZT86IGFueSxcbiAgYXJnU2V0VmFsdWVGb3JjZT86IGJvb2xlYW4gfCAxIHwgMFxuKTogYW55ID0+IHtcbiAgaWYgKHR5cGVvZiBhcmdDaGVjayAhPT0gJ3N0cmluZycgJiYgdHlwZW9mIGFyZ0NoZWNrICE9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiAnJ1xuICB9XG4gIGNvbnN0IHRlbUtleSA9IGFyZ0NoZWNrLnRvU3RyaW5nKCkuc3BsaXQoJy4nKVxuICBjb25zdCB0ZW1MZW4gPSB0ZW1LZXkubGVuZ3RoXG4gIGlmICghYXJnRGF0YSkge1xuICAgIHJldHVybiBhcmdWYWx1ZVxuICB9XG4gIGlmICh0ZW1MZW4gPiAxKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1MZW4gLSAxOyBpKyspIHtcbiAgICAgIGlmICh0eXBlb2YgYXJnRGF0YVt0ZW1LZXlbaV1dICE9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoYXJnU2V0VmFsdWVGb3JjZSkge1xuICAgICAgICAgIExvZy5lcnJvcihgJHt0ZW1LZXlbaV19IGlzIG5vdCBvYmplY3RgKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcmdWYWx1ZVxuICAgICAgfVxuICAgICAgYXJnRGF0YSA9IGFyZ0RhdGFbdGVtS2V5W2ldXVxuICAgIH1cbiAgfVxuICBpZiAoYXJnU2V0VmFsdWVGb3JjZSkge1xuICAgIGFyZ0RhdGFbdGVtS2V5W3RlbUxlbiAtIDFdXSA9IGFyZ1ZhbHVlXG4gIH1cbiAgaWYgKHR5cGVvZiBhcmdWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gYXJnRGF0YVt0ZW1LZXlbdGVtTGVuIC0gMV1dXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGFyZ0RhdGFbdGVtS2V5W3RlbUxlbiAtIDFdXSB8fCBhcmdWYWx1ZVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBHZXRDYWNoZURhdGEgPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+IHtcbiAgcmV0dXJuIFNhZmVEYXRhKENhY2hlT2JqLCBrZXksIHZhbHVlKVxufVxuXG5leHBvcnQgY29uc3QgU2V0Q2FjaGVEYXRhID0gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiB7XG4gIHJldHVybiBTYWZlRGF0YShDYWNoZU9iaiwga2V5LCB2YWx1ZSwgdHJ1ZSlcbn1cblxuLy8gZXhwb3J0IGNvbnN0IFNsZWVwID0gKG1zOiBudW1iZXIpID0+IHtcbi8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSlcbi8vIH1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { IRes } from 'types/common'\nimport { Request, Response } from 'express'\nimport { GetJwt } from './jwt'\nimport { IUsername } from 'service/user/types'\nimport { Msg } from './../msg'\nimport Log from './log'\n\ninterface ICacheObj {\n  username: { [key: string]: IUsername }\n}\nconst CacheObj: ICacheObj = {\n  username: {},\n}\nexport const ResJson = async (\n  req: Request,\n  res: Response,\n  data: any,\n  code = 0,\n  msg = '',\n  token = ''\n) => {\n  // auto cerate new token if token is expired\n  if (!token && req.needNewToken) {\n    delete req.tokenInfo.exp\n    delete req.tokenInfo.iat\n    token = await GetJwt(req.tokenInfo)\n  }\n  // locked user tips\n  if (code === 1000) {\n    const min = Number(process.env.LOCK_EXPIRATION || 1) / 60\n    msg = Msg[code] + `,Please try again in ${min} minutes`\n  }\n  const re: IRes = {\n    code,\n    data,\n    msg,\n    token,\n  }\n  return res.json(re)\n}\n\nexport const SafeData = (\n  argData: any,\n  argCheck: string,\n  argValue?: any,\n  argSetValueForce?: boolean | 1 | 0\n): any => {\n  if (typeof argCheck !== 'string' && typeof argCheck !== 'number') {\n    return ''\n  }\n  const temKey = argCheck.toString().split('.')\n  const temLen = temKey.length\n  if (!argData) {\n    return argValue\n  }\n  if (temLen > 1) {\n    for (let i = 0; i < temLen - 1; i++) {\n      if (typeof argData[temKey[i]] !== 'object') {\n        if (argSetValueForce) {\n          Log.error(`${temKey[i]} is not object`)\n        }\n        return argValue\n      }\n      argData = argData[temKey[i]]\n    }\n  }\n  if (argSetValueForce) {\n    argData[temKey[temLen - 1]] = argValue\n  }\n  if (typeof argValue === 'undefined') {\n    return argData[temKey[temLen - 1]]\n  } else {\n    return argData[temKey[temLen - 1]] || argValue\n  }\n}\n\nexport const GetCacheData = (key: string, value: any) => {\n  return SafeData(CacheObj, key, value)\n}\n\nexport const SetCacheData = (key: string, value: any) => {\n  return SafeData(CacheObj, key, value, true)\n}\n\n// export const Sleep = (ms: number) => {\n//   return new Promise((resolve) => setTimeout(resolve, ms))\n// }\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/de/index_de5025888430d0bab164b41873d7d17f.map","wrapperLength":82},"result":{"scriptId":"1382","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9315,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9312,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":14}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":2},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":14}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":2},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":16},{"startOffset":612,"endOffset":635,"count":14},{"startOffset":636,"endOffset":683,"count":2}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":833,"endOffset":914,"count":1},{"startOffset":891,"endOffset":911,"count":0}],"isBlockCoverage":true},{"functionName":"ResJson","ranges":[{"startOffset":1242,"endOffset":1860,"count":14}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1328,"endOffset":1859,"count":14},{"startOffset":1407,"endOffset":1426,"count":11},{"startOffset":1428,"endOffset":1559,"count":2},{"startOffset":1607,"endOffset":1752,"count":1},{"startOffset":1664,"endOffset":1668,"count":0}],"isBlockCoverage":true},{"functionName":"SafeData","ranges":[{"startOffset":1906,"endOffset":2802,"count":12},{"startOffset":1996,"endOffset":2027,"count":0},{"startOffset":2029,"endOffset":2055,"count":0},{"startOffset":2159,"endOffset":2191,"count":0},{"startOffset":2317,"endOffset":2494,"count":0},{"startOffset":2579,"endOffset":2634,"count":5},{"startOffset":2676,"endOffset":2727,"count":0},{"startOffset":2782,"endOffset":2793,"count":4}],"isBlockCoverage":true},{"functionName":"GetCacheData","ranges":[{"startOffset":2854,"endOffset":2929,"count":7}],"isBlockCoverage":true},{"functionName":"SetCacheData","ranges":[{"startOffset":2989,"endOffset":3070,"count":5}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GetJwt = void 0;\nconst jsonwebtoken_1 = __importDefault(require(\"jsonwebtoken\"));\nconst config_1 = __importDefault(require(\"config\"));\nconst GetJwt = (argData) => {\n    return new Promise((resolve, reject) => {\n        jsonwebtoken_1.default.sign(argData, config_1.default.get('jwtSecret'), { expiresIn: process.env.JWT_EXPIRATION }, (err, token) => {\n            if (err)\n                return reject(err);\n            return resolve(token || '');\n        });\n    });\n};\nexports.GetJwt = GetJwt;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9qd3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZ0VBQThCO0FBQzlCLG9EQUEyQjtBQUdwQixNQUFNLE1BQU0sR0FBRyxDQUFDLE9BQW1CLEVBQUUsRUFBRTtJQUM1QyxPQUFPLElBQUksT0FBTyxDQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQzdDLHNCQUFHLENBQUMsSUFBSSxDQUNOLE9BQU8sRUFDUCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFDdkIsRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsRUFDekMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDYixJQUFJLEdBQUc7Z0JBQUUsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDM0IsT0FBTyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQzdCLENBQUMsQ0FDRixDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUE7QUFaWSxRQUFBLE1BQU0sVUFZbEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9qd3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nXG5pbXBvcnQgY29uZmlnIGZyb20gJ2NvbmZpZydcbmltcG9ydCB7IElUb2tlbkluZm8gfSBmcm9tICcuLi90eXBlcy9jb21tb24nXG5cbmV4cG9ydCBjb25zdCBHZXRKd3QgPSAoYXJnRGF0YTogSVRva2VuSW5mbykgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgand0LnNpZ24oXG4gICAgICBhcmdEYXRhLFxuICAgICAgY29uZmlnLmdldCgnand0U2VjcmV0JyksXG4gICAgICB7IGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04gfSxcbiAgICAgIChlcnIsIHRva2VuKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiByZWplY3QoZXJyKVxuICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbiB8fCAnJylcbiAgICAgIH1cbiAgICApXG4gIH0pXG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import jwt from 'jsonwebtoken'\nimport config from 'config'\nimport { ITokenInfo } from '../types/common'\n\nexport const GetJwt = (argData: ITokenInfo) => {\n  return new Promise<string>((resolve, reject) => {\n    jwt.sign(\n      argData,\n      config.get('jwtSecret'),\n      { expiresIn: process.env.JWT_EXPIRATION },\n      (err, token) => {\n        if (err) return reject(err)\n        return resolve(token || '')\n      }\n    )\n  })\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/7e/jwt_7e58fc9dd22eca515ab4b9177ad476f5.map","wrapperLength":82},"result":{"scriptId":"1383","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/jwt.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":2385,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":2382,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"GetJwt","ranges":[{"startOffset":456,"endOffset":777,"count":6}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":494,"endOffset":773,"count":6}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":640,"endOffset":765,"count":6},{"startOffset":695,"endOffset":714,"count":0},{"startOffset":748,"endOffset":753,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Msg = void 0;\nexports.Msg = {\n    0: 'Success',\n    1: 'User not found, created automatically',\n    1000: 'User is locked',\n    1001: 'Username or password error',\n    1004: 'User not found',\n    4000: 'Bad params',\n    5000: 'Server error',\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9tc2cudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQWEsUUFBQSxHQUFHLEdBRVo7SUFDRixDQUFDLEVBQUUsU0FBUztJQUNaLENBQUMsRUFBRSx1Q0FBdUM7SUFDMUMsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixJQUFJLEVBQUUsNEJBQTRCO0lBQ2xDLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsSUFBSSxFQUFFLFlBQVk7SUFDbEIsSUFBSSxFQUFFLGNBQWM7Q0FDckIsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL21zZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgTXNnOiB7XG4gIFtrZXk6IG51bWJlcl06IHN0cmluZ1xufSA9IHtcbiAgMDogJ1N1Y2Nlc3MnLFxuICAxOiAnVXNlciBub3QgZm91bmQsIGNyZWF0ZWQgYXV0b21hdGljYWxseScsXG4gIDEwMDA6ICdVc2VyIGlzIGxvY2tlZCcsXG4gIDEwMDE6ICdVc2VybmFtZSBvciBwYXNzd29yZCBlcnJvcicsXG4gIDEwMDQ6ICdVc2VyIG5vdCBmb3VuZCcsXG4gIDQwMDA6ICdCYWQgcGFyYW1zJyxcbiAgNTAwMDogJ1NlcnZlciBlcnJvcicsXG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"export const Msg: {\n  [key: number]: string\n} = {\n  0: 'Success',\n  1: 'User not found, created automatically',\n  1000: 'User is locked',\n  1001: 'Username or password error',\n  1004: 'User not found',\n  4000: 'Bad params',\n  5000: 'Server error',\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/90/msg_90e59fb000316ea123cbc6d3763671c8.map","wrapperLength":82},"result":{"scriptId":"1414","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/msg.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":1365,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":1362,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CreateUser = exports.CheckUser = exports.FindUser = void 0;\nconst index_1 = require(\"../../utils/index\");\nconst User_1 = __importDefault(require(\"../../models/User\"));\nconst bcryptjs_1 = __importDefault(require(\"bcryptjs\"));\nconst log_1 = __importDefault(require(\"./../../utils/log\"));\nconst FindUser = (uid) => __awaiter(void 0, void 0, void 0, function* () {\n    if (!uid) {\n        return null;\n    }\n    const user = yield User_1.default.findById(uid)\n        .select('-password')\n        .catch((err) => {\n        log_1.default.error(err);\n        return null;\n    });\n    if (!user) {\n        return null;\n    }\n    return user;\n});\nexports.FindUser = FindUser;\nconst CheckUser = (userInfo) => __awaiter(void 0, void 0, void 0, function* () {\n    log_1.default.debug('CheckUser', userInfo);\n    const cacheUser = (0, index_1.GetCacheData)('username.' + (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username), {\n        errorRecord: [],\n        lockDate: 0,\n        uid: '',\n    });\n    // check is it lock\n    const now = Date.now();\n    if (cacheUser.lockDate - now > 0) {\n        return Promise.reject(1000);\n    }\n    const { username, password } = userInfo;\n    try {\n        const user = yield User_1.default.findOne({ username });\n        if (user) {\n            const isMatch = yield bcryptjs_1.default.compare(password, user.password);\n            // check 5min 3 error\n            if (!isMatch) {\n                cacheUser.errorRecord.push(now);\n                (0, index_1.SetCacheData)('username.' + (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username), cacheUser);\n                const last5Min = now - 5 * 60 * 1000;\n                const temLen = cacheUser.errorRecord.length || 0;\n                if (temLen > 3 && cacheUser.errorRecord[temLen - 1] > last5Min) {\n                    cacheUser.lockDate =\n                        now + Number(process.env.LOCK_EXPIRATION || 1) * 1000;\n                    cacheUser.errorRecord = [];\n                    (0, index_1.SetCacheData)('username.' + (userInfo === null || userInfo === void 0 ? void 0 : userInfo.username), cacheUser);\n                    return Promise.reject(1000);\n                }\n                return Promise.reject(1001);\n            }\n            else {\n                return user;\n            }\n        }\n        else {\n            return null;\n        }\n    }\n    catch (e) {\n        log_1.default.error('CheckUser', e);\n        return Promise.reject(5000);\n    }\n});\nexports.CheckUser = CheckUser;\nconst CreateUser = (userInfo, ip) => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n        const salt = yield bcryptjs_1.default.genSalt(10);\n        const hashed = yield bcryptjs_1.default.hash(userInfo.password, salt);\n        userInfo.password = hashed;\n        userInfo.ip = ip;\n        const newUser = new User_1.default(userInfo);\n        yield newUser.save();\n        return newUser;\n    }\n    catch (e) {\n        return Promise.reject(e);\n    }\n});\nexports.CreateUser = CreateUser;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9zZXJ2aWNlL3VzZXIvaW5kZXgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQ0EsNkNBQThEO0FBQzlELDZEQUErQztBQUMvQyx3REFBNkI7QUFDN0IsNERBQW1DO0FBRzVCLE1BQU0sUUFBUSxHQUFHLENBQU8sR0FBVyxFQUFFLEVBQUU7SUFDNUMsSUFBSSxDQUFDLEdBQUcsRUFBRTtRQUNSLE9BQU8sSUFBSSxDQUFBO0tBQ1o7SUFDRCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDO1NBQ2xDLE1BQU0sQ0FBQyxXQUFXLENBQUM7U0FDbkIsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDYixhQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ2QsT0FBTyxJQUFJLENBQUE7SUFDYixDQUFDLENBQUMsQ0FBQTtJQUNKLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFDVCxPQUFPLElBQUksQ0FBQTtLQUNaO0lBQ0QsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEsQ0FBQTtBQWRZLFFBQUEsUUFBUSxZQWNwQjtBQUVNLE1BQU0sU0FBUyxHQUFHLENBQU8sUUFBZSxFQUFFLEVBQUU7SUFDakQsYUFBRyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDaEMsTUFBTSxTQUFTLEdBQWMsSUFBQSxvQkFBWSxFQUFDLFdBQVcsSUFBRyxRQUFRLGFBQVIsUUFBUSx1QkFBUixRQUFRLENBQUUsUUFBUSxDQUFBLEVBQUU7UUFDMUUsV0FBVyxFQUFFLEVBQUU7UUFDZixRQUFRLEVBQUUsQ0FBQztRQUNYLEdBQUcsRUFBRSxFQUFFO0tBQ1IsQ0FBQyxDQUFBO0lBQ0YsbUJBQW1CO0lBQ25CLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUN0QixJQUFJLFNBQVMsQ0FBQyxRQUFRLEdBQUcsR0FBRyxHQUFHLENBQUMsRUFBRTtRQUNoQyxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7S0FDNUI7SUFFRCxNQUFNLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLFFBQVEsQ0FBQTtJQUN2QyxJQUFJO1FBQ0YsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQTtRQUM3QyxJQUFJLElBQUksRUFBRTtZQUNSLE1BQU0sT0FBTyxHQUFHLE1BQU0sa0JBQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUM3RCxxQkFBcUI7WUFDckIsSUFBSSxDQUFDLE9BQU8sRUFBRTtnQkFDWixTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtnQkFDL0IsSUFBQSxvQkFBWSxFQUFDLFdBQVcsSUFBRyxRQUFRLGFBQVIsUUFBUSx1QkFBUixRQUFRLENBQUUsUUFBUSxDQUFBLEVBQUUsU0FBUyxDQUFDLENBQUE7Z0JBRXpELE1BQU0sUUFBUSxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQTtnQkFDcEMsTUFBTSxNQUFNLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFBO2dCQUNoRCxJQUFJLE1BQU0sR0FBRyxDQUFDLElBQUksU0FBUyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsUUFBUSxFQUFFO29CQUM5RCxTQUFTLENBQUMsUUFBUTt3QkFDaEIsR0FBRyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUE7b0JBQ3ZELFNBQVMsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFBO29CQUMxQixJQUFBLG9CQUFZLEVBQUMsV0FBVyxJQUFHLFFBQVEsYUFBUixRQUFRLHVCQUFSLFFBQVEsQ0FBRSxRQUFRLENBQUEsRUFBRSxTQUFTLENBQUMsQ0FBQTtvQkFDekQsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO2lCQUM1QjtnQkFDRCxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7YUFDNUI7aUJBQU07Z0JBQ0wsT0FBTyxJQUFJLENBQUE7YUFDWjtTQUNGO2FBQU07WUFDTCxPQUFPLElBQUksQ0FBQTtTQUNaO0tBQ0Y7SUFBQyxPQUFPLENBQUMsRUFBRTtRQUNWLGFBQUcsQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQWMsQ0FBQyxDQUFBO1FBQ3RDLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUM1QjtBQUNILENBQUMsQ0FBQSxDQUFBO0FBM0NZLFFBQUEsU0FBUyxhQTJDckI7QUFFTSxNQUFNLFVBQVUsR0FBRyxDQUFPLFFBQWUsRUFBRSxFQUFVLEVBQUUsRUFBRTtJQUM5RCxJQUFJO1FBQ0YsTUFBTSxJQUFJLEdBQUcsTUFBTSxrQkFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUNyQyxNQUFNLE1BQU0sR0FBRyxNQUFNLGtCQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDekQsUUFBUSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUE7UUFDMUIsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUE7UUFDaEIsTUFBTSxPQUFPLEdBQUcsSUFBSSxjQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDbEMsTUFBTSxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDcEIsT0FBTyxPQUFPLENBQUE7S0FDZjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1YsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO0tBQ3pCO0FBQ0gsQ0FBQyxDQUFBLENBQUE7QUFaWSxRQUFBLFVBQVUsY0FZdEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9zZXJ2aWNlL3VzZXIvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVVzZXJuYW1lIH0gZnJvbSAnLi90eXBlcydcbmltcG9ydCB7IEdldENhY2hlRGF0YSwgU2V0Q2FjaGVEYXRhIH0gZnJvbSAnLi4vLi4vdXRpbHMvaW5kZXgnXG5pbXBvcnQgVXNlciwgeyBJVXNlciB9IGZyb20gJy4uLy4uL21vZGVscy9Vc2VyJ1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcydcbmltcG9ydCBMb2cgZnJvbSAnLi8uLi8uLi91dGlscy9sb2cnXG5pbXBvcnQgeyBBbnlPYmplY3QgfSBmcm9tICcuLy4uLy4uL3R5cGVzL2NvbW1vbidcblxuZXhwb3J0IGNvbnN0IEZpbmRVc2VyID0gYXN5bmMgKHVpZDogc3RyaW5nKSA9PiB7XG4gIGlmICghdWlkKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZCh1aWQpXG4gICAgLnNlbGVjdCgnLXBhc3N3b3JkJylcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgTG9nLmVycm9yKGVycilcbiAgICAgIHJldHVybiBudWxsXG4gICAgfSlcbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuICByZXR1cm4gdXNlclxufVxuXG5leHBvcnQgY29uc3QgQ2hlY2tVc2VyID0gYXN5bmMgKHVzZXJJbmZvOiBJVXNlcikgPT4ge1xuICBMb2cuZGVidWcoJ0NoZWNrVXNlcicsIHVzZXJJbmZvKVxuICBjb25zdCBjYWNoZVVzZXI6IElVc2VybmFtZSA9IEdldENhY2hlRGF0YSgndXNlcm5hbWUuJyArIHVzZXJJbmZvPy51c2VybmFtZSwge1xuICAgIGVycm9yUmVjb3JkOiBbXSxcbiAgICBsb2NrRGF0ZTogMCxcbiAgICB1aWQ6ICcnLFxuICB9KVxuICAvLyBjaGVjayBpcyBpdCBsb2NrXG4gIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgaWYgKGNhY2hlVXNlci5sb2NrRGF0ZSAtIG5vdyA+IDApIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoMTAwMClcbiAgfVxuXG4gIGNvbnN0IHsgdXNlcm5hbWUsIHBhc3N3b3JkIH0gPSB1c2VySW5mb1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB1c2VybmFtZSB9KVxuICAgIGlmICh1c2VyKSB7XG4gICAgICBjb25zdCBpc01hdGNoID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXG4gICAgICAvLyBjaGVjayA1bWluIDMgZXJyb3JcbiAgICAgIGlmICghaXNNYXRjaCkge1xuICAgICAgICBjYWNoZVVzZXIuZXJyb3JSZWNvcmQucHVzaChub3cpXG4gICAgICAgIFNldENhY2hlRGF0YSgndXNlcm5hbWUuJyArIHVzZXJJbmZvPy51c2VybmFtZSwgY2FjaGVVc2VyKVxuXG4gICAgICAgIGNvbnN0IGxhc3Q1TWluID0gbm93IC0gNSAqIDYwICogMTAwMFxuICAgICAgICBjb25zdCB0ZW1MZW4gPSBjYWNoZVVzZXIuZXJyb3JSZWNvcmQubGVuZ3RoIHx8IDBcbiAgICAgICAgaWYgKHRlbUxlbiA+IDMgJiYgY2FjaGVVc2VyLmVycm9yUmVjb3JkW3RlbUxlbiAtIDFdID4gbGFzdDVNaW4pIHtcbiAgICAgICAgICBjYWNoZVVzZXIubG9ja0RhdGUgPVxuICAgICAgICAgICAgbm93ICsgTnVtYmVyKHByb2Nlc3MuZW52LkxPQ0tfRVhQSVJBVElPTiB8fCAxKSAqIDEwMDBcbiAgICAgICAgICBjYWNoZVVzZXIuZXJyb3JSZWNvcmQgPSBbXVxuICAgICAgICAgIFNldENhY2hlRGF0YSgndXNlcm5hbWUuJyArIHVzZXJJbmZvPy51c2VybmFtZSwgY2FjaGVVc2VyKVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgxMDAwKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgxMDAxKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHVzZXJcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBMb2cuZXJyb3IoJ0NoZWNrVXNlcicsIGUgYXMgQW55T2JqZWN0KVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdCg1MDAwKVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBDcmVhdGVVc2VyID0gYXN5bmMgKHVzZXJJbmZvOiBJVXNlciwgaXA6IHN0cmluZykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMClcbiAgICBjb25zdCBoYXNoZWQgPSBhd2FpdCBiY3J5cHQuaGFzaCh1c2VySW5mby5wYXNzd29yZCwgc2FsdClcbiAgICB1c2VySW5mby5wYXNzd29yZCA9IGhhc2hlZFxuICAgIHVzZXJJbmZvLmlwID0gaXBcbiAgICBjb25zdCBuZXdVc2VyID0gbmV3IFVzZXIodXNlckluZm8pXG4gICAgYXdhaXQgbmV3VXNlci5zYXZlKClcbiAgICByZXR1cm4gbmV3VXNlclxuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGUpXG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { IUsername } from './types'\nimport { GetCacheData, SetCacheData } from '../../utils/index'\nimport User, { IUser } from '../../models/User'\nimport bcrypt from 'bcryptjs'\nimport Log from './../../utils/log'\nimport { AnyObject } from './../../types/common'\n\nexport const FindUser = async (uid: string) => {\n  if (!uid) {\n    return null\n  }\n  const user = await User.findById(uid)\n    .select('-password')\n    .catch((err) => {\n      Log.error(err)\n      return null\n    })\n  if (!user) {\n    return null\n  }\n  return user\n}\n\nexport const CheckUser = async (userInfo: IUser) => {\n  Log.debug('CheckUser', userInfo)\n  const cacheUser: IUsername = GetCacheData('username.' + userInfo?.username, {\n    errorRecord: [],\n    lockDate: 0,\n    uid: '',\n  })\n  // check is it lock\n  const now = Date.now()\n  if (cacheUser.lockDate - now > 0) {\n    return Promise.reject(1000)\n  }\n\n  const { username, password } = userInfo\n  try {\n    const user = await User.findOne({ username })\n    if (user) {\n      const isMatch = await bcrypt.compare(password, user.password)\n      // check 5min 3 error\n      if (!isMatch) {\n        cacheUser.errorRecord.push(now)\n        SetCacheData('username.' + userInfo?.username, cacheUser)\n\n        const last5Min = now - 5 * 60 * 1000\n        const temLen = cacheUser.errorRecord.length || 0\n        if (temLen > 3 && cacheUser.errorRecord[temLen - 1] > last5Min) {\n          cacheUser.lockDate =\n            now + Number(process.env.LOCK_EXPIRATION || 1) * 1000\n          cacheUser.errorRecord = []\n          SetCacheData('username.' + userInfo?.username, cacheUser)\n          return Promise.reject(1000)\n        }\n        return Promise.reject(1001)\n      } else {\n        return user\n      }\n    } else {\n      return null\n    }\n  } catch (e) {\n    Log.error('CheckUser', e as AnyObject)\n    return Promise.reject(5000)\n  }\n}\n\nexport const CreateUser = async (userInfo: IUser, ip: string) => {\n  try {\n    const salt = await bcrypt.genSalt(10)\n    const hashed = await bcrypt.hash(userInfo.password, salt)\n    userInfo.password = hashed\n    userInfo.ip = ip\n    const newUser = new User(userInfo)\n    await newUser.save()\n    return newUser\n  } catch (e) {\n    return Promise.reject(e)\n  }\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/97/index_97c6371bfce0621a6edeaac468a68cff.map","wrapperLength":82},"result":{"scriptId":"1416","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/service/user/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":10946,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":10943,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":11}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":20},{"startOffset":241,"endOffset":248,"count":13},{"startOffset":249,"endOffset":296,"count":7}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":7}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":11}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":20},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":31},{"startOffset":612,"endOffset":635,"count":11},{"startOffset":636,"endOffset":683,"count":20}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":833,"endOffset":914,"count":3},{"startOffset":885,"endOffset":890,"count":2},{"startOffset":891,"endOffset":911,"count":1}],"isBlockCoverage":true},{"functionName":"FindUser","ranges":[{"startOffset":1290,"endOffset":1624,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1333,"endOffset":1623,"count":2},{"startOffset":1362,"endOffset":1390,"count":0},{"startOffset":1576,"endOffset":1622,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1487,"endOffset":1558,"count":1}],"isBlockCoverage":true},{"functionName":"CheckUser","ranges":[{"startOffset":1673,"endOffset":3481,"count":7}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1721,"endOffset":3480,"count":7},{"startOffset":1888,"endOffset":1896,"count":0},{"startOffset":2082,"endOffset":2126,"count":0},{"startOffset":2265,"endOffset":3318,"count":5},{"startOffset":2414,"endOffset":3246,"count":4},{"startOffset":2563,"endOffset":2571,"count":0},{"startOffset":2720,"endOffset":2724,"count":0},{"startOffset":2757,"endOffset":2804,"count":1},{"startOffset":2806,"endOffset":3187,"count":1},{"startOffset":2914,"endOffset":2918,"count":0},{"startOffset":3078,"endOffset":3086,"count":0},{"startOffset":3187,"endOffset":3246,"count":3},{"startOffset":3246,"endOffset":3308,"count":1},{"startOffset":3318,"endOffset":3368,"count":2},{"startOffset":3379,"endOffset":3478,"count":0}],"isBlockCoverage":true},{"functionName":"CreateUser","ranges":[{"startOffset":3533,"endOffset":3982,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":3585,"endOffset":3981,"count":2},{"startOffset":3928,"endOffset":3979,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst mongoose_1 = require(\"mongoose\");\nconst userSchema = new mongoose_1.Schema({\n    username: {\n        type: String,\n        required: true,\n        unique: true,\n    },\n    password: {\n        type: String,\n        required: true,\n    },\n    ip: {\n        type: String,\n    },\n    updateTime: {\n        type: Date,\n        default: Date.now(),\n    },\n    createTime: {\n        type: Date,\n        default: Date.now(),\n    },\n    lastLogin: {\n        type: Date,\n        default: Date.now(),\n    },\n});\nconst User = (0, mongoose_1.model)('User', userSchema);\nexports.default = User;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9tb2RlbHMvVXNlci50cyIsIm1hcHBpbmdzIjoiOztBQUFBLHVDQUF3QztBQVd4QyxNQUFNLFVBQVUsR0FBRyxJQUFJLGlCQUFNLENBQVE7SUFDbkMsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFLE1BQU07UUFDWixRQUFRLEVBQUUsSUFBSTtRQUNkLE1BQU0sRUFBRSxJQUFJO0tBQ2I7SUFDRCxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsTUFBTTtRQUNaLFFBQVEsRUFBRSxJQUFJO0tBQ2Y7SUFDRCxFQUFFLEVBQUU7UUFDRixJQUFJLEVBQUUsTUFBTTtLQUNiO0lBQ0QsVUFBVSxFQUFFO1FBQ1YsSUFBSSxFQUFFLElBQUk7UUFDVixPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtLQUNwQjtJQUNELFVBQVUsRUFBRTtRQUNWLElBQUksRUFBRSxJQUFJO1FBQ1YsT0FBTyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7S0FDcEI7SUFDRCxTQUFTLEVBQUU7UUFDVCxJQUFJLEVBQUUsSUFBSTtRQUNWLE9BQU8sRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO0tBQ3BCO0NBQ0YsQ0FBQyxDQUFBO0FBQ0YsTUFBTSxJQUFJLEdBQUcsSUFBQSxnQkFBSyxFQUFRLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQTtBQUM3QyxrQkFBZSxJQUFJLENBQUEiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9tb2RlbHMvVXNlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTY2hlbWEsIG1vZGVsIH0gZnJvbSAnbW9uZ29vc2UnXG5cbmV4cG9ydCBpbnRlcmZhY2UgSVVzZXIge1xuICBfaWQ/OiBzdHJpbmdcbiAgdXNlcm5hbWU6IHN0cmluZ1xuICBwYXNzd29yZDogc3RyaW5nXG4gIGlwPzogc3RyaW5nXG4gIGNyZWF0ZVRpbWU/OiBudW1iZXJcbiAgdXBkYXRlVGltZT86IG51bWJlclxuICBsYXN0TG9naW4/OiBudW1iZXJcbn1cbmNvbnN0IHVzZXJTY2hlbWEgPSBuZXcgU2NoZW1hPElVc2VyPih7XG4gIHVzZXJuYW1lOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgIHVuaXF1ZTogdHJ1ZSxcbiAgfSxcbiAgcGFzc3dvcmQ6IHtcbiAgICB0eXBlOiBTdHJpbmcsXG4gICAgcmVxdWlyZWQ6IHRydWUsXG4gIH0sXG4gIGlwOiB7XG4gICAgdHlwZTogU3RyaW5nLFxuICB9LFxuICB1cGRhdGVUaW1lOiB7XG4gICAgdHlwZTogRGF0ZSxcbiAgICBkZWZhdWx0OiBEYXRlLm5vdygpLFxuICB9LFxuICBjcmVhdGVUaW1lOiB7XG4gICAgdHlwZTogRGF0ZSxcbiAgICBkZWZhdWx0OiBEYXRlLm5vdygpLFxuICB9LFxuICBsYXN0TG9naW46IHtcbiAgICB0eXBlOiBEYXRlLFxuICAgIGRlZmF1bHQ6IERhdGUubm93KCksXG4gIH0sXG59KVxuY29uc3QgVXNlciA9IG1vZGVsPElVc2VyPignVXNlcicsIHVzZXJTY2hlbWEpXG5leHBvcnQgZGVmYXVsdCBVc2VyXG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { Schema, model } from 'mongoose'\n\nexport interface IUser {\n  _id?: string\n  username: string\n  password: string\n  ip?: string\n  createTime?: number\n  updateTime?: number\n  lastLogin?: number\n}\nconst userSchema = new Schema<IUser>({\n  username: {\n    type: String,\n    required: true,\n    unique: true,\n  },\n  password: {\n    type: String,\n    required: true,\n  },\n  ip: {\n    type: String,\n  },\n  updateTime: {\n    type: Date,\n    default: Date.now(),\n  },\n  createTime: {\n    type: Date,\n    default: Date.now(),\n  },\n  lastLogin: {\n    type: Date,\n    default: Date.now(),\n  },\n})\nconst User = model<IUser>('User', userSchema)\nexport default User\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/41/User_41b37da7bf1c598bac3f44fbe69c3392.map","wrapperLength":82},"result":{"scriptId":"1417","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/models/User.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":2795,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":2792,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst express_1 = require(\"express\");\nconst express_validator_1 = require(\"express-validator\");\nconst index_1 = require(\"./../../utils/index\");\nconst jwt_1 = require(\"./../../utils/jwt\");\nconst user_1 = require(\"../../service/user\");\nconst router = (0, express_1.Router)();\nrouter.all('/login', [\n    (0, express_validator_1.check)('username', 'Please include a valid username').isLength({\n        min: 1,\n        max: 30,\n    }),\n    (0, express_validator_1.check)('password', 'Please enter a password with 6 or more characters').isLength({ min: 6, max: 30 }),\n], (req, res) => __awaiter(void 0, void 0, void 0, function* () {\n    let params = req.body;\n    if (req.method === 'GET') {\n        params = req.query;\n    }\n    else if (req.method === 'POST') {\n        params = req.body;\n    }\n    const errors = (0, express_validator_1.validationResult)(req);\n    if (!errors.isEmpty()) {\n        (0, index_1.ResJson)(req, res, {}, 4000, errors.array()[0].msg);\n        return;\n    }\n    try {\n        let user = yield (0, user_1.CheckUser)(params);\n        let code = 0;\n        if (!user) {\n            user = yield (0, user_1.CreateUser)(params, req.ip);\n            code = 1;\n        }\n        else {\n            user.lastLogin = Date.now();\n            user.save();\n        }\n        const token = yield (0, jwt_1.GetJwt)({ uid: String(user._id) });\n        user.password = '';\n        (0, index_1.ResJson)(req, res, user, code, '', token);\n        return;\n    }\n    catch (e) {\n        (0, index_1.ResJson)(req, res, {}, Number(e) || 5000);\n        return;\n    }\n}));\nexports.default = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9yb3V0ZXMvYXBpL3B1Yi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBLHFDQUFtRDtBQUNuRCx5REFBMkQ7QUFDM0QsK0NBQTZDO0FBQzdDLDJDQUEwQztBQUMxQyw2Q0FBMEQ7QUFFMUQsTUFBTSxNQUFNLEdBQVcsSUFBQSxnQkFBTSxHQUFFLENBQUE7QUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FDUixRQUFRLEVBQ1I7SUFDRSxJQUFBLHlCQUFLLEVBQUMsVUFBVSxFQUFFLGlDQUFpQyxDQUFDLENBQUMsUUFBUSxDQUFDO1FBQzVELEdBQUcsRUFBRSxDQUFDO1FBQ04sR0FBRyxFQUFFLEVBQUU7S0FDUixDQUFDO0lBQ0YsSUFBQSx5QkFBSyxFQUNILFVBQVUsRUFDVixtREFBbUQsQ0FDcEQsQ0FBQyxRQUFRLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQztDQUNoQyxFQUNELENBQU8sR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ3BDLElBQUksTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUE7SUFDckIsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLEtBQUssRUFBRTtRQUN4QixNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtLQUNuQjtTQUFNLElBQUksR0FBRyxDQUFDLE1BQU0sS0FBSyxNQUFNLEVBQUU7UUFDaEMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUE7S0FDbEI7SUFDRCxNQUFNLE1BQU0sR0FBRyxJQUFBLG9DQUFnQixFQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEVBQUU7UUFDckIsSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNsRCxPQUFNO0tBQ1A7SUFDRCxJQUFJO1FBQ0YsSUFBSSxJQUFJLEdBQUcsTUFBTSxJQUFBLGdCQUFTLEVBQUMsTUFBTSxDQUFDLENBQUE7UUFDbEMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFBO1FBQ1osSUFBSSxDQUFDLElBQUksRUFBRTtZQUNULElBQUksR0FBRyxNQUFNLElBQUEsaUJBQVUsRUFBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1lBQ3ZDLElBQUksR0FBRyxDQUFDLENBQUE7U0FDVDthQUFNO1lBQ0wsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7WUFDM0IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFBO1NBQ1o7UUFDRCxNQUFNLEtBQUssR0FBRyxNQUFNLElBQUEsWUFBTSxFQUFDLEVBQUUsR0FBRyxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3JELElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFBO1FBQ2xCLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFDeEMsT0FBTTtLQUNQO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFDVixJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUE7UUFDeEMsT0FBTTtLQUNQO0FBQ0gsQ0FBQyxDQUFBLENBQ0YsQ0FBQTtBQUVELGtCQUFlLE1BQU0sQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL3JvdXRlcy9hcGkvcHViLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJvdXRlciwgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJ1xuaW1wb3J0IHsgY2hlY2ssIHZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICdleHByZXNzLXZhbGlkYXRvcidcbmltcG9ydCB7IFJlc0pzb24gfSBmcm9tICcuLy4uLy4uL3V0aWxzL2luZGV4J1xuaW1wb3J0IHsgR2V0Snd0IH0gZnJvbSAnLi8uLi8uLi91dGlscy9qd3QnXG5pbXBvcnQgeyBDaGVja1VzZXIsIENyZWF0ZVVzZXIgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL3VzZXInXG5cbmNvbnN0IHJvdXRlcjogUm91dGVyID0gUm91dGVyKClcbnJvdXRlci5hbGwoXG4gICcvbG9naW4nLFxuICBbXG4gICAgY2hlY2soJ3VzZXJuYW1lJywgJ1BsZWFzZSBpbmNsdWRlIGEgdmFsaWQgdXNlcm5hbWUnKS5pc0xlbmd0aCh7XG4gICAgICBtaW46IDEsXG4gICAgICBtYXg6IDMwLFxuICAgIH0pLFxuICAgIGNoZWNrKFxuICAgICAgJ3Bhc3N3b3JkJyxcbiAgICAgICdQbGVhc2UgZW50ZXIgYSBwYXNzd29yZCB3aXRoIDYgb3IgbW9yZSBjaGFyYWN0ZXJzJ1xuICAgICkuaXNMZW5ndGgoeyBtaW46IDYsIG1heDogMzAgfSksXG4gIF0sXG4gIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICBsZXQgcGFyYW1zID0gcmVxLmJvZHlcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAgIHBhcmFtcyA9IHJlcS5xdWVyeVxuICAgIH0gZWxzZSBpZiAocmVxLm1ldGhvZCA9PT0gJ1BPU1QnKSB7XG4gICAgICBwYXJhbXMgPSByZXEuYm9keVxuICAgIH1cbiAgICBjb25zdCBlcnJvcnMgPSB2YWxpZGF0aW9uUmVzdWx0KHJlcSlcbiAgICBpZiAoIWVycm9ycy5pc0VtcHR5KCkpIHtcbiAgICAgIFJlc0pzb24ocmVxLCByZXMsIHt9LCA0MDAwLCBlcnJvcnMuYXJyYXkoKVswXS5tc2cpXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGxldCB1c2VyID0gYXdhaXQgQ2hlY2tVc2VyKHBhcmFtcylcbiAgICAgIGxldCBjb2RlID0gMFxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHVzZXIgPSBhd2FpdCBDcmVhdGVVc2VyKHBhcmFtcywgcmVxLmlwKVxuICAgICAgICBjb2RlID0gMVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXNlci5sYXN0TG9naW4gPSBEYXRlLm5vdygpXG4gICAgICAgIHVzZXIuc2F2ZSgpXG4gICAgICB9XG4gICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IEdldEp3dCh7IHVpZDogU3RyaW5nKHVzZXIuX2lkKSB9KVxuICAgICAgdXNlci5wYXNzd29yZCA9ICcnXG4gICAgICBSZXNKc29uKHJlcSwgcmVzLCB1c2VyLCBjb2RlLCAnJywgdG9rZW4pXG4gICAgICByZXR1cm5cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBSZXNKc29uKHJlcSwgcmVzLCB7fSwgTnVtYmVyKGUpIHx8IDUwMDApXG4gICAgICByZXR1cm5cbiAgICB9XG4gIH1cbilcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyXG4iXSwidmVyc2lvbiI6M30=","originalCode":"import { Router, Request, Response } from 'express'\nimport { check, validationResult } from 'express-validator'\nimport { ResJson } from './../../utils/index'\nimport { GetJwt } from './../../utils/jwt'\nimport { CheckUser, CreateUser } from '../../service/user'\n\nconst router: Router = Router()\nrouter.all(\n  '/login',\n  [\n    check('username', 'Please include a valid username').isLength({\n      min: 1,\n      max: 30,\n    }),\n    check(\n      'password',\n      'Please enter a password with 6 or more characters'\n    ).isLength({ min: 6, max: 30 }),\n  ],\n  async (req: Request, res: Response) => {\n    let params = req.body\n    if (req.method === 'GET') {\n      params = req.query\n    } else if (req.method === 'POST') {\n      params = req.body\n    }\n    const errors = validationResult(req)\n    if (!errors.isEmpty()) {\n      ResJson(req, res, {}, 4000, errors.array()[0].msg)\n      return\n    }\n    try {\n      let user = await CheckUser(params)\n      let code = 0\n      if (!user) {\n        user = await CreateUser(params, req.ip)\n        code = 1\n      } else {\n        user.lastLogin = Date.now()\n        user.save()\n      }\n      const token = await GetJwt({ uid: String(user._id) })\n      user.password = ''\n      ResJson(req, res, user, code, '', token)\n      return\n    } catch (e) {\n      ResJson(req, res, {}, Number(e) || 5000)\n      return\n    }\n  }\n)\n\nexport default router\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/54/pub_54c5b7d686fbacb206b0e0400ab6600a.map","wrapperLength":82},"result":{"scriptId":"1837","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/routes/api/pub.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":6836,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":6833,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":12}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":12},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":12}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":8},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":4},{"startOffset":541,"endOffset":565,"count":0}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":24},{"startOffset":612,"endOffset":635,"count":12},{"startOffset":636,"endOffset":683,"count":12}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1405,"endOffset":2410,"count":12}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1453,"endOffset":2409,"count":12},{"startOffset":1525,"endOffset":1560,"count":11},{"startOffset":1560,"endOffset":1631,"count":1},{"startOffset":1726,"endOffset":1822,"count":5},{"startOffset":1822,"endOffset":1888,"count":7},{"startOffset":1888,"endOffset":1930,"count":3},{"startOffset":1930,"endOffset":2028,"count":2},{"startOffset":2028,"endOffset":2119,"count":1},{"startOffset":2119,"endOffset":2311,"count":3},{"startOffset":2311,"endOffset":2407,"count":4},{"startOffset":2376,"endOffset":2383,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = __importDefault(require(\"config\"));\nconst http_status_codes_1 = __importDefault(require(\"http-status-codes\"));\nconst jsonwebtoken_1 = __importDefault(require(\"jsonwebtoken\"));\nfunction default_1(req, res, next) {\n    var _a;\n    const token = (_a = req.header('tk')) === null || _a === void 0 ? void 0 : _a.replace('.web.', '');\n    if (!token) {\n        res.status(http_status_codes_1.default.UNAUTHORIZED).json({ msg: 'token is required' });\n        return;\n    }\n    try {\n        const tkInfo = jsonwebtoken_1.default.verify(token || '', config_1.default.get('jwtSecret'));\n        // check if token need update\n        const remainTime = (((tkInfo === null || tkInfo === void 0 ? void 0 : tkInfo.exp) || 1) * 1000 - Date.now()) / 1000;\n        if (remainTime < (Number(process.env.JWT_EXPIRATION) || 0) / 2) {\n            req.needNewToken = true;\n        }\n        else {\n            req.needNewToken = false;\n        }\n        req.tokenInfo = tkInfo;\n        next();\n    }\n    catch (err) {\n        res.status(http_status_codes_1.default.UNAUTHORIZED).json({ msg: 'token is invalid' });\n        return;\n    }\n}\nexports.default = default_1;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9taWRkbGV3YXJlL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvREFBMkI7QUFFM0IsMEVBQStDO0FBQy9DLGdFQUE4QjtBQUU5QixtQkFBeUIsR0FBWSxFQUFFLEdBQWEsRUFBRSxJQUFrQjs7SUFDdEUsTUFBTSxLQUFLLEdBQUcsTUFBQSxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQywwQ0FBRSxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFBO0lBQ3BELElBQUksQ0FBQyxLQUFLLEVBQUU7UUFDVixHQUFHLENBQUMsTUFBTSxDQUFDLDJCQUFlLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLG1CQUFtQixFQUFFLENBQUMsQ0FBQTtRQUMzRSxPQUFNO0tBQ1A7SUFDRCxJQUFJO1FBQ0YsTUFBTSxNQUFNLEdBQVEsc0JBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLEVBQUUsRUFBRSxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFBO1FBQ3BFLDZCQUE2QjtRQUM3QixNQUFNLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUUsR0FBRyxLQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUE7UUFDbEUsSUFBSSxVQUFVLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDOUQsR0FBRyxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUE7U0FDeEI7YUFBTTtZQUNMLEdBQUcsQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFBO1NBQ3pCO1FBQ0QsR0FBRyxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUE7UUFDdEIsSUFBSSxFQUFFLENBQUE7S0FDUDtJQUFDLE9BQU8sR0FBRyxFQUFFO1FBQ1osR0FBRyxDQUFDLE1BQU0sQ0FBQywyQkFBZSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxrQkFBa0IsRUFBRSxDQUFDLENBQUE7UUFDMUUsT0FBTTtLQUNQO0FBQ0gsQ0FBQztBQXJCRCw0QkFxQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9taWRkbGV3YXJlL2F1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNvbmZpZyBmcm9tICdjb25maWcnXG5pbXBvcnQgeyBSZXNwb25zZSwgTmV4dEZ1bmN0aW9uLCBSZXF1ZXN0IH0gZnJvbSAnZXhwcmVzcydcbmltcG9ydCBIdHRwU3RhdHVzQ29kZXMgZnJvbSAnaHR0cC1zdGF0dXMtY29kZXMnXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbidcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgbmV4dDogTmV4dEZ1bmN0aW9uKSB7XG4gIGNvbnN0IHRva2VuID0gcmVxLmhlYWRlcigndGsnKT8ucmVwbGFjZSgnLndlYi4nLCAnJylcbiAgaWYgKCF0b2tlbikge1xuICAgIHJlcy5zdGF0dXMoSHR0cFN0YXR1c0NvZGVzLlVOQVVUSE9SSVpFRCkuanNvbih7IG1zZzogJ3Rva2VuIGlzIHJlcXVpcmVkJyB9KVxuICAgIHJldHVyblxuICB9XG4gIHRyeSB7XG4gICAgY29uc3QgdGtJbmZvOiBhbnkgPSBqd3QudmVyaWZ5KHRva2VuIHx8ICcnLCBjb25maWcuZ2V0KCdqd3RTZWNyZXQnKSlcbiAgICAvLyBjaGVjayBpZiB0b2tlbiBuZWVkIHVwZGF0ZVxuICAgIGNvbnN0IHJlbWFpblRpbWUgPSAoKHRrSW5mbz8uZXhwIHx8IDEpICogMTAwMCAtIERhdGUubm93KCkpIC8gMTAwMFxuICAgIGlmIChyZW1haW5UaW1lIDwgKE51bWJlcihwcm9jZXNzLmVudi5KV1RfRVhQSVJBVElPTikgfHwgMCkgLyAyKSB7XG4gICAgICByZXEubmVlZE5ld1Rva2VuID0gdHJ1ZVxuICAgIH0gZWxzZSB7XG4gICAgICByZXEubmVlZE5ld1Rva2VuID0gZmFsc2VcbiAgICB9XG4gICAgcmVxLnRva2VuSW5mbyA9IHRrSW5mb1xuICAgIG5leHQoKVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICByZXMuc3RhdHVzKEh0dHBTdGF0dXNDb2Rlcy5VTkFVVEhPUklaRUQpLmpzb24oeyBtc2c6ICd0b2tlbiBpcyBpbnZhbGlkJyB9KVxuICAgIHJldHVyblxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import config from 'config'\nimport { Response, NextFunction, Request } from 'express'\nimport HttpStatusCodes from 'http-status-codes'\nimport jwt from 'jsonwebtoken'\n\nexport default function (req: Request, res: Response, next: NextFunction) {\n  const token = req.header('tk')?.replace('.web.', '')\n  if (!token) {\n    res.status(HttpStatusCodes.UNAUTHORIZED).json({ msg: 'token is required' })\n    return\n  }\n  try {\n    const tkInfo: any = jwt.verify(token || '', config.get('jwtSecret'))\n    // check if token need update\n    const remainTime = ((tkInfo?.exp || 1) * 1000 - Date.now()) / 1000\n    if (remainTime < (Number(process.env.JWT_EXPIRATION) || 0) / 2) {\n      req.needNewToken = true\n    } else {\n      req.needNewToken = false\n    }\n    req.tokenInfo = tkInfo\n    next()\n  } catch (err) {\n    res.status(HttpStatusCodes.UNAUTHORIZED).json({ msg: 'token is invalid' })\n    return\n  }\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/ce/auth_cea71628f056c941aa66399fd6ea5e8b.map","wrapperLength":82},"result":{"scriptId":"1979","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/middleware/auth.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4398,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4395,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":3},{"startOffset":204,"endOffset":209,"count":1},{"startOffset":210,"endOffset":230,"count":2}],"isBlockCoverage":true},{"functionName":"default_1","ranges":[{"startOffset":491,"endOffset":1431,"count":4},{"startOffset":608,"endOffset":616,"count":0},{"startOffset":660,"endOffset":780,"count":1},{"startOffset":780,"endOffset":850,"count":3},{"startOffset":850,"endOffset":855,"count":0},{"startOffset":977,"endOffset":997,"count":2},{"startOffset":998,"endOffset":1006,"count":0},{"startOffset":1007,"endOffset":1019,"count":2},{"startOffset":1021,"endOffset":1025,"count":0},{"startOffset":1117,"endOffset":1121,"count":0},{"startOffset":1128,"endOffset":1176,"count":2},{"startOffset":1176,"endOffset":1239,"count":0},{"startOffset":1239,"endOffset":1298,"count":2},{"startOffset":1298,"endOffset":1429,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DB = exports.CloseDb = exports.ConnectDb = void 0;\nconst mongoose_1 = __importDefault(require(\"mongoose\"));\nconst log_1 = __importDefault(require(\"./log\"));\nlet db;\nconst ConnectDb = (uri = '') => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n        const mongoURI = uri || process.env.DATABASE_URL || '';\n        const conn = mongoose_1.default.connection;\n        conn.on('disconnected', () => {\n            log_1.default.log('MongoDB has Closed');\n        });\n        if (process.env.NODE_ENV === 'test' && !uri) {\n            log_1.default.log('MongoDB is in test mode');\n        }\n        else {\n            db = yield mongoose_1.default.connect(mongoURI);\n            log_1.default.log('MongoDB Connected');\n        }\n        return true;\n    }\n    catch (err) {\n        log_1.default.error('ConnectDb', err);\n        return Promise.reject(5000);\n    }\n});\nexports.ConnectDb = ConnectDb;\nconst CloseDb = () => __awaiter(void 0, void 0, void 0, function* () {\n    yield mongoose_1.default.connection.close();\n    log_1.default.log('MongoDB Closed');\n    return true;\n});\nexports.CloseDb = CloseDb;\nexports.DB = db;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9kYi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQSx3REFBK0I7QUFDL0IsZ0RBQXVCO0FBRXZCLElBQUksRUFBRSxDQUFBO0FBQ0MsTUFBTSxTQUFTLEdBQUcsQ0FBTyxHQUFHLEdBQUcsRUFBRSxFQUFFLEVBQUU7SUFDMUMsSUFBSTtRQUNGLE1BQU0sUUFBUSxHQUFXLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUE7UUFDOUQsTUFBTSxJQUFJLEdBQUcsa0JBQVEsQ0FBQyxVQUFVLENBQUE7UUFDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1lBQzNCLGFBQUcsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtRQUMvQixDQUFDLENBQUMsQ0FBQTtRQUNGLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQzNDLGFBQUcsQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQTtTQUNuQzthQUFNO1lBQ0wsRUFBRSxHQUFHLE1BQU0sa0JBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDckMsYUFBRyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO1NBQzdCO1FBQ0QsT0FBTyxJQUFJLENBQUE7S0FDWjtJQUFDLE9BQU8sR0FBRyxFQUFFO1FBQ1osYUFBRyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsR0FBZ0IsQ0FBQyxDQUFBO1FBQ3hDLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUM1QjtBQUNILENBQUMsQ0FBQSxDQUFBO0FBbEJZLFFBQUEsU0FBUyxhQWtCckI7QUFDTSxNQUFNLE9BQU8sR0FBRyxHQUFTLEVBQUU7SUFDaEMsTUFBTSxrQkFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNqQyxhQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFDekIsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEsQ0FBQTtBQUpZLFFBQUEsT0FBTyxXQUluQjtBQUNZLFFBQUEsRUFBRSxHQUFHLEVBQUUsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL3V0aWxzL2RiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSdcbmltcG9ydCBMb2cgZnJvbSAnLi9sb2cnXG5pbXBvcnQgeyBBbnlPYmplY3QgfSBmcm9tICcuLy4uL3R5cGVzL2NvbW1vbidcbmxldCBkYlxuZXhwb3J0IGNvbnN0IENvbm5lY3REYiA9IGFzeW5jICh1cmkgPSAnJykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1vbmdvVVJJOiBzdHJpbmcgPSB1cmkgfHwgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8ICcnXG4gICAgY29uc3QgY29ubiA9IG1vbmdvb3NlLmNvbm5lY3Rpb25cbiAgICBjb25uLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBMb2cubG9nKCdNb25nb0RCIGhhcyBDbG9zZWQnKVxuICAgIH0pXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgJiYgIXVyaSkge1xuICAgICAgTG9nLmxvZygnTW9uZ29EQiBpcyBpbiB0ZXN0IG1vZGUnKVxuICAgIH0gZWxzZSB7XG4gICAgICBkYiA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QobW9uZ29VUkkpXG4gICAgICBMb2cubG9nKCdNb25nb0RCIENvbm5lY3RlZCcpXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIExvZy5lcnJvcignQ29ubmVjdERiJywgZXJyIGFzIEFueU9iamVjdClcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoNTAwMClcbiAgfVxufVxuZXhwb3J0IGNvbnN0IENsb3NlRGIgPSBhc3luYyAoKSA9PiB7XG4gIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uY2xvc2UoKVxuICBMb2cubG9nKCdNb25nb0RCIENsb3NlZCcpXG4gIHJldHVybiB0cnVlXG59XG5leHBvcnQgY29uc3QgREIgPSBkYlxuIl0sInZlcnNpb24iOjN9","originalCode":"import mongoose from 'mongoose'\nimport Log from './log'\nimport { AnyObject } from './../types/common'\nlet db\nexport const ConnectDb = async (uri = '') => {\n  try {\n    const mongoURI: string = uri || process.env.DATABASE_URL || ''\n    const conn = mongoose.connection\n    conn.on('disconnected', () => {\n      Log.log('MongoDB has Closed')\n    })\n    if (process.env.NODE_ENV === 'test' && !uri) {\n      Log.log('MongoDB is in test mode')\n    } else {\n      db = await mongoose.connect(mongoURI)\n      Log.log('MongoDB Connected')\n    }\n    return true\n  } catch (err) {\n    Log.error('ConnectDb', err as AnyObject)\n    return Promise.reject(5000)\n  }\n}\nexport const CloseDb = async () => {\n  await mongoose.connection.close()\n  Log.log('MongoDB Closed')\n  return true\n}\nexport const DB = db\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/29/db_29c17df077d30229bdc117b1fa252c97.map","wrapperLength":82},"result":{"scriptId":"1991","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/db.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4878,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4875,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":2}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":2},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":2}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":1},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":3},{"startOffset":612,"endOffset":635,"count":1},{"startOffset":636,"endOffset":683,"count":2}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":833,"endOffset":914,"count":2},{"startOffset":885,"endOffset":890,"count":1},{"startOffset":891,"endOffset":911,"count":1}],"isBlockCoverage":true},{"functionName":"ConnectDb","ranges":[{"startOffset":1170,"endOffset":1862,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1218,"endOffset":1861,"count":1},{"startOffset":1272,"endOffset":1299,"count":0},{"startOffset":1300,"endOffset":1305,"count":0},{"startOffset":1517,"endOffset":1586,"count":0},{"startOffset":1756,"endOffset":1859,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1391,"endOffset":1461,"count":0}],"isBlockCoverage":false},{"functionName":"CloseDb","ranges":[{"startOffset":1911,"endOffset":2075,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1951,"endOffset":2074,"count":1},{"startOffset":2014,"endOffset":2073,"count":0}],"isBlockCoverage":true}]}}]},{"leaks":false,"numFailingTests":0,"numPassingTests":8,"numPendingTests":0,"numTodoTests":0,"perfStats":{"end":1656657015368,"runtime":1116,"slow":false,"start":1656657014252},"skipped":false,"testFilePath":"/home/runner/work/express-ts/express-ts/packages/serve/test/utils.test.ts","testResults":[{"ancestorTitles":["db"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"db ConnectDb","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"ConnectDb"},{"ancestorTitles":["db"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"db ConnectDb","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"ConnectDb"},{"ancestorTitles":["db"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"db CloseDb","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"CloseDb"},{"ancestorTitles":["index"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"index ResJson","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"ResJson"},{"ancestorTitles":["index"],"duration":16,"failureDetails":[],"failureMessages":[],"fullName":"index SafeData","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"SafeData"},{"ancestorTitles":["index"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"index SetCacheData","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"SetCacheData"},{"ancestorTitles":["index"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"index GetCacheData","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"GetCacheData"},{"ancestorTitles":["jwt"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"jwt GetJwt","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"GetJwt"}],"failureMessage":null,"v8Coverage":[{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.DB = exports.CloseDb = exports.ConnectDb = void 0;\nconst mongoose_1 = __importDefault(require(\"mongoose\"));\nconst log_1 = __importDefault(require(\"./log\"));\nlet db;\nconst ConnectDb = (uri = '') => __awaiter(void 0, void 0, void 0, function* () {\n    try {\n        const mongoURI = uri || process.env.DATABASE_URL || '';\n        const conn = mongoose_1.default.connection;\n        conn.on('disconnected', () => {\n            log_1.default.log('MongoDB has Closed');\n        });\n        if (process.env.NODE_ENV === 'test' && !uri) {\n            log_1.default.log('MongoDB is in test mode');\n        }\n        else {\n            db = yield mongoose_1.default.connect(mongoURI);\n            log_1.default.log('MongoDB Connected');\n        }\n        return true;\n    }\n    catch (err) {\n        log_1.default.error('ConnectDb', err);\n        return Promise.reject(5000);\n    }\n});\nexports.ConnectDb = ConnectDb;\nconst CloseDb = () => __awaiter(void 0, void 0, void 0, function* () {\n    yield mongoose_1.default.connection.close();\n    log_1.default.log('MongoDB Closed');\n    return true;\n});\nexports.CloseDb = CloseDb;\nexports.DB = db;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9kYi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBQSx3REFBK0I7QUFDL0IsZ0RBQXVCO0FBRXZCLElBQUksRUFBRSxDQUFBO0FBQ0MsTUFBTSxTQUFTLEdBQUcsQ0FBTyxHQUFHLEdBQUcsRUFBRSxFQUFFLEVBQUU7SUFDMUMsSUFBSTtRQUNGLE1BQU0sUUFBUSxHQUFXLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxFQUFFLENBQUE7UUFDOUQsTUFBTSxJQUFJLEdBQUcsa0JBQVEsQ0FBQyxVQUFVLENBQUE7UUFDaEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFO1lBQzNCLGFBQUcsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtRQUMvQixDQUFDLENBQUMsQ0FBQTtRQUNGLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQzNDLGFBQUcsQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQTtTQUNuQzthQUFNO1lBQ0wsRUFBRSxHQUFHLE1BQU0sa0JBQVEsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7WUFDckMsYUFBRyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO1NBQzdCO1FBQ0QsT0FBTyxJQUFJLENBQUE7S0FDWjtJQUFDLE9BQU8sR0FBRyxFQUFFO1FBQ1osYUFBRyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsR0FBZ0IsQ0FBQyxDQUFBO1FBQ3hDLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtLQUM1QjtBQUNILENBQUMsQ0FBQSxDQUFBO0FBbEJZLFFBQUEsU0FBUyxhQWtCckI7QUFDTSxNQUFNLE9BQU8sR0FBRyxHQUFTLEVBQUU7SUFDaEMsTUFBTSxrQkFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUNqQyxhQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUE7SUFDekIsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEsQ0FBQTtBQUpZLFFBQUEsT0FBTyxXQUluQjtBQUNZLFFBQUEsRUFBRSxHQUFHLEVBQUUsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL3V0aWxzL2RiLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb25nb29zZSBmcm9tICdtb25nb29zZSdcbmltcG9ydCBMb2cgZnJvbSAnLi9sb2cnXG5pbXBvcnQgeyBBbnlPYmplY3QgfSBmcm9tICcuLy4uL3R5cGVzL2NvbW1vbidcbmxldCBkYlxuZXhwb3J0IGNvbnN0IENvbm5lY3REYiA9IGFzeW5jICh1cmkgPSAnJykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG1vbmdvVVJJOiBzdHJpbmcgPSB1cmkgfHwgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8ICcnXG4gICAgY29uc3QgY29ubiA9IG1vbmdvb3NlLmNvbm5lY3Rpb25cbiAgICBjb25uLm9uKCdkaXNjb25uZWN0ZWQnLCAoKSA9PiB7XG4gICAgICBMb2cubG9nKCdNb25nb0RCIGhhcyBDbG9zZWQnKVxuICAgIH0pXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgJiYgIXVyaSkge1xuICAgICAgTG9nLmxvZygnTW9uZ29EQiBpcyBpbiB0ZXN0IG1vZGUnKVxuICAgIH0gZWxzZSB7XG4gICAgICBkYiA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QobW9uZ29VUkkpXG4gICAgICBMb2cubG9nKCdNb25nb0RCIENvbm5lY3RlZCcpXG4gICAgfVxuICAgIHJldHVybiB0cnVlXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIExvZy5lcnJvcignQ29ubmVjdERiJywgZXJyIGFzIEFueU9iamVjdClcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoNTAwMClcbiAgfVxufVxuZXhwb3J0IGNvbnN0IENsb3NlRGIgPSBhc3luYyAoKSA9PiB7XG4gIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uY2xvc2UoKVxuICBMb2cubG9nKCdNb25nb0RCIENsb3NlZCcpXG4gIHJldHVybiB0cnVlXG59XG5leHBvcnQgY29uc3QgREIgPSBkYlxuIl0sInZlcnNpb24iOjN9","originalCode":"import mongoose from 'mongoose'\nimport Log from './log'\nimport { AnyObject } from './../types/common'\nlet db\nexport const ConnectDb = async (uri = '') => {\n  try {\n    const mongoURI: string = uri || process.env.DATABASE_URL || ''\n    const conn = mongoose.connection\n    conn.on('disconnected', () => {\n      Log.log('MongoDB has Closed')\n    })\n    if (process.env.NODE_ENV === 'test' && !uri) {\n      Log.log('MongoDB is in test mode')\n    } else {\n      db = await mongoose.connect(mongoURI)\n      Log.log('MongoDB Connected')\n    }\n    return true\n  } catch (err) {\n    Log.error('ConnectDb', err as AnyObject)\n    return Promise.reject(5000)\n  }\n}\nexport const CloseDb = async () => {\n  await mongoose.connection.close()\n  Log.log('MongoDB Closed')\n  return true\n}\nexport const DB = db\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/29/db_29c17df077d30229bdc117b1fa252c97.map","wrapperLength":82},"result":{"scriptId":"2285","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/db.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":4878,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":4875,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":3}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":2},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":3}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":1},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":1},{"startOffset":541,"endOffset":565,"count":0}],"isBlockCoverage":true},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":5},{"startOffset":612,"endOffset":635,"count":3},{"startOffset":636,"endOffset":683,"count":2}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":833,"endOffset":914,"count":2},{"startOffset":885,"endOffset":890,"count":1},{"startOffset":891,"endOffset":911,"count":1}],"isBlockCoverage":true},{"functionName":"ConnectDb","ranges":[{"startOffset":1170,"endOffset":1862,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1218,"endOffset":1861,"count":2},{"startOffset":1508,"endOffset":1515,"count":1},{"startOffset":1517,"endOffset":1724,"count":1},{"startOffset":1662,"endOffset":1724,"count":0},{"startOffset":1724,"endOffset":1859,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1391,"endOffset":1461,"count":2}],"isBlockCoverage":true},{"functionName":"CloseDb","ranges":[{"startOffset":1911,"endOffset":2075,"count":1}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1951,"endOffset":2074,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GetJwt = void 0;\nconst jsonwebtoken_1 = __importDefault(require(\"jsonwebtoken\"));\nconst config_1 = __importDefault(require(\"config\"));\nconst GetJwt = (argData) => {\n    return new Promise((resolve, reject) => {\n        jsonwebtoken_1.default.sign(argData, config_1.default.get('jwtSecret'), { expiresIn: process.env.JWT_EXPIRATION }, (err, token) => {\n            if (err)\n                return reject(err);\n            return resolve(token || '');\n        });\n    });\n};\nexports.GetJwt = GetJwt;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9qd3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsZ0VBQThCO0FBQzlCLG9EQUEyQjtBQUdwQixNQUFNLE1BQU0sR0FBRyxDQUFDLE9BQW1CLEVBQUUsRUFBRTtJQUM1QyxPQUFPLElBQUksT0FBTyxDQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1FBQzdDLHNCQUFHLENBQUMsSUFBSSxDQUNOLE9BQU8sRUFDUCxnQkFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsRUFDdkIsRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsRUFDekMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDYixJQUFJLEdBQUc7Z0JBQUUsT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7WUFDM0IsT0FBTyxPQUFPLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQzdCLENBQUMsQ0FDRixDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUE7QUFaWSxRQUFBLE1BQU0sVUFZbEIiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9qd3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nXG5pbXBvcnQgY29uZmlnIGZyb20gJ2NvbmZpZydcbmltcG9ydCB7IElUb2tlbkluZm8gfSBmcm9tICcuLi90eXBlcy9jb21tb24nXG5cbmV4cG9ydCBjb25zdCBHZXRKd3QgPSAoYXJnRGF0YTogSVRva2VuSW5mbykgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgand0LnNpZ24oXG4gICAgICBhcmdEYXRhLFxuICAgICAgY29uZmlnLmdldCgnand0U2VjcmV0JyksXG4gICAgICB7IGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSQVRJT04gfSxcbiAgICAgIChlcnIsIHRva2VuKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHJldHVybiByZWplY3QoZXJyKVxuICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbiB8fCAnJylcbiAgICAgIH1cbiAgICApXG4gIH0pXG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"import jwt from 'jsonwebtoken'\nimport config from 'config'\nimport { ITokenInfo } from '../types/common'\n\nexport const GetJwt = (argData: ITokenInfo) => {\n  return new Promise<string>((resolve, reject) => {\n    jwt.sign(\n      argData,\n      config.get('jwtSecret'),\n      { expiresIn: process.env.JWT_EXPIRATION },\n      (err, token) => {\n        if (err) return reject(err)\n        return resolve(token || '')\n      }\n    )\n  })\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/7e/jwt_7e58fc9dd22eca515ab4b9177ad476f5.map","wrapperLength":82},"result":{"scriptId":"2692","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/jwt.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":2385,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":2382,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":152,"endOffset":233,"count":2},{"startOffset":204,"endOffset":209,"count":0}],"isBlockCoverage":true},{"functionName":"GetJwt","ranges":[{"startOffset":456,"endOffset":777,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":494,"endOffset":773,"count":2}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":640,"endOffset":765,"count":1},{"startOffset":695,"endOffset":714,"count":0},{"startOffset":748,"endOffset":753,"count":0}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SetCacheData = exports.GetCacheData = exports.SafeData = exports.ResJson = void 0;\nconst jwt_1 = require(\"./jwt\");\nconst msg_1 = require(\"./../msg\");\nconst log_1 = __importDefault(require(\"./log\"));\nconst CacheObj = {\n    username: {},\n};\nconst ResJson = (req, res, data, code = 0, msg = '', token = '') => __awaiter(void 0, void 0, void 0, function* () {\n    // auto cerate new token if token is expired\n    if (!token && req.needNewToken) {\n        delete req.tokenInfo.exp;\n        delete req.tokenInfo.iat;\n        token = yield (0, jwt_1.GetJwt)(req.tokenInfo);\n    }\n    // locked user tips\n    if (code === 1000) {\n        const min = Number(process.env.LOCK_EXPIRATION || 1) / 60;\n        msg = msg_1.Msg[code] + `,Please try again in ${min} minutes`;\n    }\n    const re = {\n        code,\n        data,\n        msg,\n        token,\n    };\n    return res.json(re);\n});\nexports.ResJson = ResJson;\nconst SafeData = (argData, argCheck, argValue, argSetValueForce) => {\n    if (typeof argCheck !== 'string' && typeof argCheck !== 'number') {\n        return '';\n    }\n    const temKey = argCheck.toString().split('.');\n    const temLen = temKey.length;\n    if (!argData) {\n        return argValue;\n    }\n    if (temLen > 1) {\n        for (let i = 0; i < temLen - 1; i++) {\n            if (typeof argData[temKey[i]] !== 'object') {\n                if (argSetValueForce) {\n                    log_1.default.error(`${temKey[i]} is not object`);\n                }\n                return argValue;\n            }\n            argData = argData[temKey[i]];\n        }\n    }\n    if (argSetValueForce) {\n        argData[temKey[temLen - 1]] = argValue;\n    }\n    if (typeof argValue === 'undefined') {\n        return argData[temKey[temLen - 1]];\n    }\n    else {\n        return argData[temKey[temLen - 1]] || argValue;\n    }\n};\nexports.SafeData = SafeData;\nconst GetCacheData = (key, value) => {\n    return (0, exports.SafeData)(CacheObj, key, value);\n};\nexports.GetCacheData = GetCacheData;\nconst SetCacheData = (key, value) => {\n    return (0, exports.SafeData)(CacheObj, key, value, true);\n};\nexports.SetCacheData = SetCacheData;\n// export const Sleep = (ms: number) => {\n//   return new Promise((resolve) => setTimeout(resolve, ms))\n// }\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFFQSwrQkFBOEI7QUFFOUIsa0NBQThCO0FBQzlCLGdEQUF1QjtBQUt2QixNQUFNLFFBQVEsR0FBYztJQUMxQixRQUFRLEVBQUUsRUFBRTtDQUNiLENBQUE7QUFDTSxNQUFNLE9BQU8sR0FBRyxDQUNyQixHQUFZLEVBQ1osR0FBYSxFQUNiLElBQVMsRUFDVCxJQUFJLEdBQUcsQ0FBQyxFQUNSLEdBQUcsR0FBRyxFQUFFLEVBQ1IsS0FBSyxHQUFHLEVBQUUsRUFDVixFQUFFO0lBQ0YsNENBQTRDO0lBQzVDLElBQUksQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLFlBQVksRUFBRTtRQUM5QixPQUFPLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFBO1FBQ3hCLE9BQU8sR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUE7UUFDeEIsS0FBSyxHQUFHLE1BQU0sSUFBQSxZQUFNLEVBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFBO0tBQ3BDO0lBQ0QsbUJBQW1CO0lBQ25CLElBQUksSUFBSSxLQUFLLElBQUksRUFBRTtRQUNqQixNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxlQUFlLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ3pELEdBQUcsR0FBRyxTQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsd0JBQXdCLEdBQUcsVUFBVSxDQUFBO0tBQ3hEO0lBQ0QsTUFBTSxFQUFFLEdBQVM7UUFDZixJQUFJO1FBQ0osSUFBSTtRQUNKLEdBQUc7UUFDSCxLQUFLO0tBQ04sQ0FBQTtJQUNELE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNyQixDQUFDLENBQUEsQ0FBQTtBQTFCWSxRQUFBLE9BQU8sV0EwQm5CO0FBRU0sTUFBTSxRQUFRLEdBQUcsQ0FDdEIsT0FBWSxFQUNaLFFBQWdCLEVBQ2hCLFFBQWMsRUFDZCxnQkFBa0MsRUFDN0IsRUFBRTtJQUNQLElBQUksT0FBTyxRQUFRLEtBQUssUUFBUSxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsRUFBRTtRQUNoRSxPQUFPLEVBQUUsQ0FBQTtLQUNWO0lBQ0QsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM3QyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFBO0lBQzVCLElBQUksQ0FBQyxPQUFPLEVBQUU7UUFDWixPQUFPLFFBQVEsQ0FBQTtLQUNoQjtJQUNELElBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtRQUNkLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQ25DLElBQUksT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxFQUFFO2dCQUMxQyxJQUFJLGdCQUFnQixFQUFFO29CQUNwQixhQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO2lCQUN4QztnQkFDRCxPQUFPLFFBQVEsQ0FBQTthQUNoQjtZQUNELE9BQU8sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDN0I7S0FDRjtJQUNELElBQUksZ0JBQWdCLEVBQUU7UUFDcEIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUE7S0FDdkM7SUFDRCxJQUFJLE9BQU8sUUFBUSxLQUFLLFdBQVcsRUFBRTtRQUNuQyxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7S0FDbkM7U0FBTTtRQUNMLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUE7S0FDL0M7QUFDSCxDQUFDLENBQUE7QUFqQ1ksUUFBQSxRQUFRLFlBaUNwQjtBQUVNLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBVyxFQUFFLEtBQVUsRUFBRSxFQUFFO0lBQ3RELE9BQU8sSUFBQSxnQkFBUSxFQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDdkMsQ0FBQyxDQUFBO0FBRlksUUFBQSxZQUFZLGdCQUV4QjtBQUVNLE1BQU0sWUFBWSxHQUFHLENBQUMsR0FBVyxFQUFFLEtBQVUsRUFBRSxFQUFFO0lBQ3RELE9BQU8sSUFBQSxnQkFBUSxFQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzdDLENBQUMsQ0FBQTtBQUZZLFFBQUEsWUFBWSxnQkFFeEI7QUFFRCx5Q0FBeUM7QUFDekMsNkRBQTZEO0FBQzdELElBQUkiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy91dGlscy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUmVzIH0gZnJvbSAndHlwZXMvY29tbW9uJ1xuaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJ1xuaW1wb3J0IHsgR2V0Snd0IH0gZnJvbSAnLi9qd3QnXG5pbXBvcnQgeyBJVXNlcm5hbWUgfSBmcm9tICdzZXJ2aWNlL3VzZXIvdHlwZXMnXG5pbXBvcnQgeyBNc2cgfSBmcm9tICcuLy4uL21zZydcbmltcG9ydCBMb2cgZnJvbSAnLi9sb2cnXG5cbmludGVyZmFjZSBJQ2FjaGVPYmoge1xuICB1c2VybmFtZTogeyBba2V5OiBzdHJpbmddOiBJVXNlcm5hbWUgfVxufVxuY29uc3QgQ2FjaGVPYmo6IElDYWNoZU9iaiA9IHtcbiAgdXNlcm5hbWU6IHt9LFxufVxuZXhwb3J0IGNvbnN0IFJlc0pzb24gPSBhc3luYyAoXG4gIHJlcTogUmVxdWVzdCxcbiAgcmVzOiBSZXNwb25zZSxcbiAgZGF0YTogYW55LFxuICBjb2RlID0gMCxcbiAgbXNnID0gJycsXG4gIHRva2VuID0gJydcbikgPT4ge1xuICAvLyBhdXRvIGNlcmF0ZSBuZXcgdG9rZW4gaWYgdG9rZW4gaXMgZXhwaXJlZFxuICBpZiAoIXRva2VuICYmIHJlcS5uZWVkTmV3VG9rZW4pIHtcbiAgICBkZWxldGUgcmVxLnRva2VuSW5mby5leHBcbiAgICBkZWxldGUgcmVxLnRva2VuSW5mby5pYXRcbiAgICB0b2tlbiA9IGF3YWl0IEdldEp3dChyZXEudG9rZW5JbmZvKVxuICB9XG4gIC8vIGxvY2tlZCB1c2VyIHRpcHNcbiAgaWYgKGNvZGUgPT09IDEwMDApIHtcbiAgICBjb25zdCBtaW4gPSBOdW1iZXIocHJvY2Vzcy5lbnYuTE9DS19FWFBJUkFUSU9OIHx8IDEpIC8gNjBcbiAgICBtc2cgPSBNc2dbY29kZV0gKyBgLFBsZWFzZSB0cnkgYWdhaW4gaW4gJHttaW59IG1pbnV0ZXNgXG4gIH1cbiAgY29uc3QgcmU6IElSZXMgPSB7XG4gICAgY29kZSxcbiAgICBkYXRhLFxuICAgIG1zZyxcbiAgICB0b2tlbixcbiAgfVxuICByZXR1cm4gcmVzLmpzb24ocmUpXG59XG5cbmV4cG9ydCBjb25zdCBTYWZlRGF0YSA9IChcbiAgYXJnRGF0YTogYW55LFxuICBhcmdDaGVjazogc3RyaW5nLFxuICBhcmdWYWx1ZT86IGFueSxcbiAgYXJnU2V0VmFsdWVGb3JjZT86IGJvb2xlYW4gfCAxIHwgMFxuKTogYW55ID0+IHtcbiAgaWYgKHR5cGVvZiBhcmdDaGVjayAhPT0gJ3N0cmluZycgJiYgdHlwZW9mIGFyZ0NoZWNrICE9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiAnJ1xuICB9XG4gIGNvbnN0IHRlbUtleSA9IGFyZ0NoZWNrLnRvU3RyaW5nKCkuc3BsaXQoJy4nKVxuICBjb25zdCB0ZW1MZW4gPSB0ZW1LZXkubGVuZ3RoXG4gIGlmICghYXJnRGF0YSkge1xuICAgIHJldHVybiBhcmdWYWx1ZVxuICB9XG4gIGlmICh0ZW1MZW4gPiAxKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1MZW4gLSAxOyBpKyspIHtcbiAgICAgIGlmICh0eXBlb2YgYXJnRGF0YVt0ZW1LZXlbaV1dICE9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoYXJnU2V0VmFsdWVGb3JjZSkge1xuICAgICAgICAgIExvZy5lcnJvcihgJHt0ZW1LZXlbaV19IGlzIG5vdCBvYmplY3RgKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhcmdWYWx1ZVxuICAgICAgfVxuICAgICAgYXJnRGF0YSA9IGFyZ0RhdGFbdGVtS2V5W2ldXVxuICAgIH1cbiAgfVxuICBpZiAoYXJnU2V0VmFsdWVGb3JjZSkge1xuICAgIGFyZ0RhdGFbdGVtS2V5W3RlbUxlbiAtIDFdXSA9IGFyZ1ZhbHVlXG4gIH1cbiAgaWYgKHR5cGVvZiBhcmdWYWx1ZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm4gYXJnRGF0YVt0ZW1LZXlbdGVtTGVuIC0gMV1dXG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGFyZ0RhdGFbdGVtS2V5W3RlbUxlbiAtIDFdXSB8fCBhcmdWYWx1ZVxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBHZXRDYWNoZURhdGEgPSAoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpID0+IHtcbiAgcmV0dXJuIFNhZmVEYXRhKENhY2hlT2JqLCBrZXksIHZhbHVlKVxufVxuXG5leHBvcnQgY29uc3QgU2V0Q2FjaGVEYXRhID0gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSA9PiB7XG4gIHJldHVybiBTYWZlRGF0YShDYWNoZU9iaiwga2V5LCB2YWx1ZSwgdHJ1ZSlcbn1cblxuLy8gZXhwb3J0IGNvbnN0IFNsZWVwID0gKG1zOiBudW1iZXIpID0+IHtcbi8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSlcbi8vIH1cbiJdLCJ2ZXJzaW9uIjozfQ==","originalCode":"import { IRes } from 'types/common'\nimport { Request, Response } from 'express'\nimport { GetJwt } from './jwt'\nimport { IUsername } from 'service/user/types'\nimport { Msg } from './../msg'\nimport Log from './log'\n\ninterface ICacheObj {\n  username: { [key: string]: IUsername }\n}\nconst CacheObj: ICacheObj = {\n  username: {},\n}\nexport const ResJson = async (\n  req: Request,\n  res: Response,\n  data: any,\n  code = 0,\n  msg = '',\n  token = ''\n) => {\n  // auto cerate new token if token is expired\n  if (!token && req.needNewToken) {\n    delete req.tokenInfo.exp\n    delete req.tokenInfo.iat\n    token = await GetJwt(req.tokenInfo)\n  }\n  // locked user tips\n  if (code === 1000) {\n    const min = Number(process.env.LOCK_EXPIRATION || 1) / 60\n    msg = Msg[code] + `,Please try again in ${min} minutes`\n  }\n  const re: IRes = {\n    code,\n    data,\n    msg,\n    token,\n  }\n  return res.json(re)\n}\n\nexport const SafeData = (\n  argData: any,\n  argCheck: string,\n  argValue?: any,\n  argSetValueForce?: boolean | 1 | 0\n): any => {\n  if (typeof argCheck !== 'string' && typeof argCheck !== 'number') {\n    return ''\n  }\n  const temKey = argCheck.toString().split('.')\n  const temLen = temKey.length\n  if (!argData) {\n    return argValue\n  }\n  if (temLen > 1) {\n    for (let i = 0; i < temLen - 1; i++) {\n      if (typeof argData[temKey[i]] !== 'object') {\n        if (argSetValueForce) {\n          Log.error(`${temKey[i]} is not object`)\n        }\n        return argValue\n      }\n      argData = argData[temKey[i]]\n    }\n  }\n  if (argSetValueForce) {\n    argData[temKey[temLen - 1]] = argValue\n  }\n  if (typeof argValue === 'undefined') {\n    return argData[temKey[temLen - 1]]\n  } else {\n    return argData[temKey[temLen - 1]] || argValue\n  }\n}\n\nexport const GetCacheData = (key: string, value: any) => {\n  return SafeData(CacheObj, key, value)\n}\n\nexport const SetCacheData = (key: string, value: any) => {\n  return SafeData(CacheObj, key, value, true)\n}\n\n// export const Sleep = (ms: number) => {\n//   return new Promise((resolve) => setTimeout(resolve, ms))\n// }\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/de/index_de5025888430d0bab164b41873d7d17f.map","wrapperLength":82},"result":{"scriptId":"2724","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/utils/index.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":9315,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":9312,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__awaiter","ranges":[{"startOffset":140,"endOffset":775,"count":3}],"isBlockCoverage":true},{"functionName":"adopt","ranges":[{"startOffset":191,"endOffset":299,"count":1},{"startOffset":249,"endOffset":296,"count":0}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":257,"endOffset":295,"count":0}],"isBlockCoverage":false},{"functionName":"","ranges":[{"startOffset":336,"endOffset":771,"count":3}],"isBlockCoverage":true},{"functionName":"fulfilled","ranges":[{"startOffset":373,"endOffset":464,"count":1},{"startOffset":438,"endOffset":462,"count":0}],"isBlockCoverage":true},{"functionName":"rejected","ranges":[{"startOffset":473,"endOffset":567,"count":0}],"isBlockCoverage":false},{"functionName":"step","ranges":[{"startOffset":576,"endOffset":686,"count":4},{"startOffset":612,"endOffset":635,"count":3},{"startOffset":636,"endOffset":683,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>.__importDefault","ranges":[{"startOffset":833,"endOffset":914,"count":1},{"startOffset":891,"endOffset":911,"count":0}],"isBlockCoverage":true},{"functionName":"ResJson","ranges":[{"startOffset":1242,"endOffset":1860,"count":3}],"isBlockCoverage":true},{"functionName":"","ranges":[{"startOffset":1328,"endOffset":1859,"count":3},{"startOffset":1407,"endOffset":1426,"count":1},{"startOffset":1428,"endOffset":1559,"count":1},{"startOffset":1607,"endOffset":1752,"count":1}],"isBlockCoverage":true},{"functionName":"SafeData","ranges":[{"startOffset":1906,"endOffset":2802,"count":14},{"startOffset":1996,"endOffset":2027,"count":1},{"startOffset":2029,"endOffset":2055,"count":1},{"startOffset":2055,"endOffset":2159,"count":13},{"startOffset":2159,"endOffset":2191,"count":1},{"startOffset":2191,"endOffset":2212,"count":12},{"startOffset":2212,"endOffset":2552,"count":5},{"startOffset":2259,"endOffset":2546,"count":6},{"startOffset":2317,"endOffset":2494,"count":1},{"startOffset":2494,"endOffset":2546,"count":5},{"startOffset":2546,"endOffset":2552,"count":4},{"startOffset":2552,"endOffset":2579,"count":11},{"startOffset":2579,"endOffset":2634,"count":2},{"startOffset":2634,"endOffset":2676,"count":11},{"startOffset":2676,"endOffset":2727,"count":4},{"startOffset":2727,"endOffset":2800,"count":7},{"startOffset":2782,"endOffset":2793,"count":4}],"isBlockCoverage":true},{"functionName":"GetCacheData","ranges":[{"startOffset":2854,"endOffset":2929,"count":2}],"isBlockCoverage":true},{"functionName":"SetCacheData","ranges":[{"startOffset":2989,"endOffset":3070,"count":1}],"isBlockCoverage":true}]}},{"codeTransformResult":{"code":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Msg = void 0;\nexports.Msg = {\n    0: 'Success',\n    1: 'User not found, created automatically',\n    1000: 'User is locked',\n    1001: 'Username or password error',\n    1004: 'User not found',\n    4000: 'Bad params',\n    5000: 'Server error',\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmsvZXhwcmVzcy10cy9leHByZXNzLXRzL3BhY2thZ2VzL3NlcnZlL3NyYy9tc2cudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQWEsUUFBQSxHQUFHLEdBRVo7SUFDRixDQUFDLEVBQUUsU0FBUztJQUNaLENBQUMsRUFBRSx1Q0FBdUM7SUFDMUMsSUFBSSxFQUFFLGdCQUFnQjtJQUN0QixJQUFJLEVBQUUsNEJBQTRCO0lBQ2xDLElBQUksRUFBRSxnQkFBZ0I7SUFDdEIsSUFBSSxFQUFFLFlBQVk7SUFDbEIsSUFBSSxFQUFFLGNBQWM7Q0FDckIsQ0FBQSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29yay9leHByZXNzLXRzL2V4cHJlc3MtdHMvcGFja2FnZXMvc2VydmUvc3JjL21zZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgTXNnOiB7XG4gIFtrZXk6IG51bWJlcl06IHN0cmluZ1xufSA9IHtcbiAgMDogJ1N1Y2Nlc3MnLFxuICAxOiAnVXNlciBub3QgZm91bmQsIGNyZWF0ZWQgYXV0b21hdGljYWxseScsXG4gIDEwMDA6ICdVc2VyIGlzIGxvY2tlZCcsXG4gIDEwMDE6ICdVc2VybmFtZSBvciBwYXNzd29yZCBlcnJvcicsXG4gIDEwMDQ6ICdVc2VyIG5vdCBmb3VuZCcsXG4gIDQwMDA6ICdCYWQgcGFyYW1zJyxcbiAgNTAwMDogJ1NlcnZlciBlcnJvcicsXG59XG4iXSwidmVyc2lvbiI6M30=","originalCode":"export const Msg: {\n  [key: number]: string\n} = {\n  0: 'Success',\n  1: 'User not found, created automatically',\n  1000: 'User is locked',\n  1001: 'Username or password error',\n  1004: 'User not found',\n  4000: 'Bad params',\n  5000: 'Server error',\n}\n","sourceMapPath":"/tmp/jest_rt/jest-transform-cache-f2ebdfa2e3f35f9a4740e5d8678bcac4-e1195690224eeed71261e356dfb2d91d/90/msg_90e59fb000316ea123cbc6d3763671c8.map","wrapperLength":82},"result":{"scriptId":"2725","url":"/home/runner/work/express-ts/express-ts/packages/serve/src/msg.ts","functions":[{"functionName":"","ranges":[{"startOffset":0,"endOffset":1365,"count":1}],"isBlockCoverage":true},{"functionName":"Object.<anonymous>","ranges":[{"startOffset":23,"endOffset":1362,"count":1}],"isBlockCoverage":true}]}}]}],"wasInterrupted":false,"config":{"bail":0,"changedFilesWithAncestor":false,"ci":true,"collectCoverage":true,"collectCoverageFrom":[],"coverageDirectory":"/home/runner/work/express-ts/express-ts/packages/web/build/coverage","coverageProvider":"v8","coverageReporters":["json","text","lcov","clover"],"detectLeaks":false,"detectOpenHandles":true,"errorOnDeprecated":false,"expand":false,"findRelatedTests":false,"forceExit":true,"json":false,"lastCommit":false,"listTests":false,"logHeapUsage":false,"maxConcurrency":5,"maxWorkers":1,"noStackTrace":false,"nonFlagArgs":[],"notify":false,"notifyMode":"failure-change","onlyChanged":false,"onlyFailures":false,"passWithNoTests":false,"projects":[],"reporters":[["default",{}],["/home/runner/work/express-ts/express-ts/packages/serve/node_modules/.pnpm/jest-html-reporters@3.0.9/node_modules/jest-html-reporters/index.js",{"publicPath":"../web/build/coverage","filename":"index.html","openReport":false}]],"rootDir":"/home/runner/work/express-ts/express-ts/packages/serve","runTestsByPath":false,"skipFilter":false,"testFailureExitCode":1,"testPathPattern":"","testSequencer":"/home/runner/work/express-ts/express-ts/packages/serve/node_modules/.pnpm/@jest+test-sequencer@28.1.1/node_modules/@jest/test-sequencer/build/index.js","updateSnapshot":"none","useStderr":false,"verbose":true,"watch":false,"watchAll":false,"watchman":true,"coverageLinkPath":"lcov-report/index.html"},"endTime":1656657015394,"_reporterOptions":{"publicPath":"../web/build/coverage","filename":"index.html","expand":false,"pageTitle":"","hideIcon":false,"testCommand":"npx jest","openReport":false,"failureMessageOnly":0,"enableMergeData":false,"dataMergeLevel":1,"inlineSource":false},"attachInfos":{}})